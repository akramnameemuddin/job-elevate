{% extends 'dashboard/base.html' %}
{% load static %}
{% block content %}
{% csrf_token %}
<!-- Page Header -->
<div class="page-header">
  <div class="breadcrumb">
    <div class="breadcrumb-item">
      <a href="{% url 'dashboard:home' %}" class="breadcrumb-link">
        <i class='bx bx-home'></i>
        Home
      </a>
      <i class='bx bx-chevron-right'></i>
    </div>
    <div class="breadcrumb-item">
      <span>Job Listings</span>
    </div>
  </div>

  <div class="page-title-section">
    <h1 class="page-title">
      <i class='bx bx-briefcase'></i>
      Job Listings
    </h1>
    <p class="page-subtitle">Discover opportunities that match your skills and career goals</p>
  </div>

  <div class="page-actions">
    <a href="{% url 'jobs:search_jobs' %}" class="btn btn-outline-primary">
      <i class='bx bx-search'></i>
      <span>Advanced Search</span>
    </a>
    <a href="{% url 'jobs:job_analytics' %}" class="btn btn-outline-primary">
      <i class='bx bx-line-chart'></i>
      <span>Job Market Trends</span>
    </a>
  </div>
</div>

<!-- Messages/Notifications -->
{% if messages %}
<div class="notifications">
  {% for message in messages %}
  <div class="notification {% if message.tags %}notification-{{ message.tags }}{% endif %}">
    {% if message.tags == 'success' %}
    <i class='bx bx-check-circle'></i>
    {% elif message.tags == 'error' %}
    <i class='bx bx-error'></i>
    {% elif message.tags == 'warning' %}
    <i class='bx bx-error-circle'></i>
    {% else %}
    <i class='bx bx-info-circle'></i>
    {% endif %}
    <p>{{ message }}</p>
    <button class="notification-close"><i class='bx bx-x'></i></button>
  </div>
  {% endfor %}
</div>
{% endif %}


<!-- Recommended Jobs Section -->
{% if recommended_jobs %}
<div class="content-section recommended-section">
  <div class="section-header">
    <div class="section-title-container">
      <h2 class="section-title"><i class='bx bx-star'></i> Recommended For You</h2>
      <span class="section-subtitle">Jobs matching your profile and preferences</span>
    </div>
    <a href="{% url 'jobs:recommended_jobs' %}" class="btn btn-outline">View All</a>
  </div>
  
  <div class="job-grid">
    {% for rec in recommended_jobs %}
    <div class="job-card {% if rec.score > 0.7 %}job-card-highlighted{% endif %}">
      <div class="job-card-top">
        <div class="job-card-header">
          <div class="job-title-container">
            <h3 class="job-title">{{ rec.job.title }}</h3>
            <p class="job-company">{{ rec.job.company }}</p>
          </div>
          <div class="job-match-score">
            <span class="match-percent">{{ rec.score|floatformat:2 }}</span>
          </div>
        </div>
        
        <div class="job-details">
          <div class="job-detail-item">
            <i class='bx bx-map'></i>
            <span>{{ rec.job.location }}</span>
          </div>
          <div class="job-detail-item">
            <i class='bx bx-time'></i>
            <span>{{ rec.job.get_job_type_display }}</span>
          </div>
          {% if rec.job.salary %}
          <div class="job-detail-item">
            <i class='bx bx-dollar-circle'></i>
            <span>{{ rec.job.salary }}</span>
          </div>
          {% endif %}
        </div>
          
        {% if rec.job.skills %}
        <div class="job-skills">
          {% for skill in rec.job.skills|slice:":3" %}
          <span class="skill-tag">{{ skill }}</span>
          {% endfor %}
          {% if rec.job.skills|length > 3 %}
          <span class="more-skills">+{{ rec.job.skills|length|add:"-3" }}</span>
          {% endif %}
        </div>
        {% endif %}
            
        <div class="job-reason">
          <i class='bx bx-bulb'></i>
          <p>{{ rec.reason }}</p>
        </div>
      </div>
      
      <div class="job-card-footer">
        <a href="{% url 'jobs:job_detail' job_id=rec.job.id %}" class="btn btn-primary">View Details</a>
        {% if rec.job.id in bookmarked_job_ids %}
        <button class="btn-icon bookmark-btn active" data-job-id="{{ rec.job.id }}" title="Remove Bookmark">
          <i class='bx bxs-bookmark'></i>
        </button>
        {% else %}
        <button class="btn-icon bookmark-btn" data-job-id="{{ rec.job.id }}" title="Bookmark Job">
          <i class='bx bx-bookmark'></i>
        </button>
        {% endif %}
      </div>
    </div>
    {% endfor %}
  </div>
</div>
{% endif %}

<!-- Tab Navigation -->
<div class="content-section job-listings-section">
  <div class="tab-navigation">
    <button class="tab-button active" data-tab="all-jobs">
      <i class='bx bx-briefcase'></i>
      <span>All Jobs</span>
    </button>
    <button class="tab-button" data-tab="bookmarked">
      <i class='bx bx-bookmark'></i>
      <span>Bookmarked</span>
    </button>
    <button class="tab-button" data-tab="applied">
      <i class='bx bx-check-circle'></i>
      <span>Applied</span>
    </button>
  </div>

  <!-- All Jobs Tab -->
  <div class="tab-content active" id="all-jobs-content">
    <div class="job-list-container">
      <table class="job-list-table" id="job-listing-table">
        <thead>
          <tr>
            <th>Job Title</th>
            <th>Company</th>
            <th>Location</th>
            <th>Type</th>
            <th>Posted</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for job in jobs %}
          <tr class="job-row" data-job-id="{{ job.id }}">
            <td class="job-title-cell">
              <a href="{% url 'jobs:job_detail' job_id=job.id %}" class="job-list-title">{{ job.title }}</a>
              {% if job.id in bookmarked_job_ids %}
              <i class='bx bxs-bookmark job-bookmark-indicator'></i>
              {% endif %}
            </td>
            <td>{{ job.company }}</td>
            <td>{{ job.location }}</td>
            <td><span class="job-type-badge type-{{ job.job_type|slugify }}">{{ job.get_job_type_display }}</span></td>
            <td>{{ job.created_at|timesince }} ago</td>       
            <td class="job-actions-cell">
              <div class="job-actions">
                <a href="{% url 'jobs:job_detail' job_id=job.id %}" class="btn-icon" title="View Details">
                  <i class='bx bx-detail'></i>
                </a>
                {% if job.id in bookmarked_job_ids %}
                <button class="btn-icon bookmark-btn active" data-job-id="{{ job.id }}" title="Remove Bookmark">
                  <i class='bx bxs-bookmark'></i>
                </button>
                {% else %}
                <button class="btn-icon bookmark-btn" data-job-id="{{ job.id }}" title="Bookmark Job">
                  <i class='bx bx-bookmark'></i>
                </button>
                {% endif %}
              </div>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="6" class="no-jobs-message">
              <div class="empty-state">
                <i class='bx bx-search-alt'></i>
                <p>No jobs found matching your criteria</p>
                <a href="{% url 'jobs:job_listings' %}" class="btn btn-outline">Clear Filters</a>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

 <!-- Fixed Bookmarked Tab -->
<div class="tab-content" id="bookmarked-content">
  {% if bookmarked_jobs %}
  <div class="job-list-container">
    <table class="job-list-table">
      <thead>
        <tr>
          <th>Job Title</th>
          <th>Company</th>
          <th>Location</th>
          <th>Type</th>
          <th>Bookmarked</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for bookmark in bookmarked_jobs %}
        <tr class="job-row" data-job-id="{{ bookmark.job.id }}">
          <td class="job-title-cell">
            <a href="{% url 'jobs:job_detail' job_id=bookmark.job.id %}" class="job-list-title">{{ bookmark.job.title }}</a>
            <i class='bx bxs-bookmark job-bookmark-indicator'></i>
          </td>
          <td>{{ bookmark.job.company }}</td>
          <td>{{ bookmark.job.location }}</td>
          <td><span class="job-type-badge type-{{ bookmark.job.job_type|slugify }}">{{ bookmark.job.get_job_type_display }}</span></td>
          <td>{{ bookmark.bookmarked_at|timesince }} ago</td>
          <td class="job-actions-cell">
            <div class="job-actions">
              <a href="{% url 'jobs:job_detail' job_id=bookmark.job.id %}" class="btn-icon" title="View Details">
                <i class='bx bx-detail'></i>
              </a>
              <button class="btn-icon bookmark-btn active" data-job-id="{{ bookmark.job.id }}" title="Remove Bookmark">
                <i class='bx bxs-bookmark'></i>
              </button>
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <div class="empty-state">
    <i class='bx bx-bookmark'></i>
    <h3>No Bookmarked Jobs Yet</h3>
    <p>Jobs you bookmark will appear here for easy access</p>
    <a href="#" class="btn btn-outline" onclick="switchToTab('all-jobs')">Browse Jobs</a>
  </div>
  {% endif %}
</div>

<!-- Applied Tab -->
<div class="tab-content" id="applied-content">
  {% if applied_jobs %}
  <div class="job-list-container">
    <table class="job-list-table">
      <thead>
        <tr>
          <th>Job Title</th>
          <th>Company</th>
          <th>Location</th>
          <th>Status</th>
          <th>Applied</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for application in applied_jobs %}
        <tr class="job-row" data-job-id="{{ application.job.id }}">
          <td class="job-title-cell">
            <a href="{% url 'jobs:job_detail' job_id=application.job.id %}" class="job-list-title">{{ application.job.title }}</a>
            <i class='bx bx-check-circle job-applied-indicator'></i>
          </td>
          <td>{{ application.job.company }}</td>
          <td>{{ application.job.location }}</td>
          <td>
            <span class="application-status-badge status-{{ application.status|slugify }}">
              {{ application.get_status_display }}
            </span>
          </td>
          <td>{{ application.applied_at|timesince }} ago</td>
          <td class="job-actions-cell">
            <div class="job-actions">
              <a href="{% url 'jobs:application_detail' application_id=application.id %}" class="btn-icon" title="View Application">
                <i class='bx bx-detail'></i>
              </a>
              <a href="{% url 'jobs:job_detail' job_id=application.job.id %}" class="btn-icon" title="View Job">
                <i class='bx bx-briefcase'></i>
              </a>
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <div class="empty-state">
    <i class='bx bx-check-square'></i>
    <h3>No Applications Yet</h3>
    <p>Jobs you've applied to will appear here</p>
    <a href="#" class="btn btn-outline" onclick="switchToTab('all-jobs')">Browse Jobs</a>
  </div>
  {% endif %}
</div>
<style>
/* Modern CSS Variables - Updated for dark mode */
:root {
  /* Light mode colors */
  --primary-color: #4361ee;
  --primary-light: rgba(67, 97, 238, 0.1);
  --primary-dark: #3a56d4;
  --secondary-color: #7c3aed;
  --success-color: #2ecc71;
  --warning-color: #f39c12;
  --danger-color: #e74c3c;
  --info-color: #3498db;

  --background-color: #f9fafb;
  --card-bg: #ffffff;
  --hover-bg: #f3f4f6;
  --border-color: #e5e7eb;
  --text-color: #111827;
  --text-light: #6b7280;

  --shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
}

/* Dark mode colors */
[data-theme="dark"] {
  --primary-color: #818cf8;
  --primary-light: rgba(129, 140, 248, 0.1);
  --primary-dark: #6366f1;
  --secondary-color: #a78bfa;
  --success-color: #34d399;
  --warning-color: #fbbf24;
  --danger-color: #f87171;
  --info-color: #60a5fa;

  --background-color: #111827;
  --card-bg: #1f2937;
  --hover-bg: #374151;
  --border-color: #374151;
  --text-color: #f9fafb;
  --text-light: #d1d5db;

  --shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.4);
}

/* Update existing components */
.job-card {
  background: var(--card-bg);
  border: 1px solid var(--border-color);
  transition: all 0.3s ease;
}

.job-card:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
  border-color: var(--primary-color);
}

.job-title {
  color: var(--text-color);
}

.company-name {
  color: var(--text-light);
}

.meta-badge {
  background: var(--hover-bg);
  color: var(--text-light);
  border: 1px solid var(--border-color);
}

.skill-tag {
  background: var(--hover-bg);
  color: var(--text-color);
  border: 1px solid var(--border-color);
}

/* Update notification styles */
.notification {
  background: var(--card-bg);
  border: 1px solid var(--border-color);
}

[data-theme="dark"] .notification.success {
  background: rgba(52, 211, 153, 0.1);
  border-color: var(--success-color);
}

[data-theme="dark"] .notification.error {
  background: rgba(248, 113, 113, 0.1);
  border-color: var(--danger-color);
}

[data-theme="dark"] .notification.warning {
  background: rgba(251, 191, 36, 0.1);
  border-color: var(--warning-color);
}

[data-theme="dark"] .notification.info {
  background: rgba(96, 165, 250, 0.1);
  border-color: var(--info-color);
}

/* Empty state improvements */
.empty-state {
  background: var(--card-bg);
  border: 1px solid var(--border-color);
}

.empty-state i {
  color: var(--text-light);
}

.empty-state h3 {
  color: var(--text-color);
}

.empty-state p {
  color: var(--text-light);
}

/* Button improvements */
.btn-primary {
  background: var(--primary-color);
  color: #ffffff;
  border: none;
}

.btn-primary:hover {
  background: var(--primary-dark);
}

.btn-outline {
  background: transparent;
  color: var(--text-color);
  border: 1px solid var(--border-color);
}

[data-theme="dark"] .btn-outline:hover {
  background: var(--hover-bg);
  border-color: var(--primary-color);
}

/* Table improvements */
.job-list-table th {
  background: var(--hover-bg);
  color: var(--text-color);
  border-bottom: 1px solid var(--border-color);
}

.job-list-table td {
  color: var(--text-light);
  border-bottom: 1px solid var(--border-color);
}

.job-list-table tr:hover {
  background: var(--hover-bg);
}

/* Search and filter improvements */
input[type="text"],
input[type="search"],
select {
  background: var(--card-bg);
  color: var(--text-color);
  border: 1px solid var(--border-color);
}

input[type="text"]:focus,
input[type="search"]:focus,
select:focus {
  border-color: var(--primary-color);
  box-shadow: 0 0 0 2px var(--primary-light);
}

/* Add smooth transitions */
.job-card,
.btn,
.notification,
input,
select {
  transition: all 0.2s ease;
}

/* Improve accessibility */
@media (prefers-reduced-motion: reduce) {
  * {
    transition: none !important;
  }
}

/* High contrast improvements for dark mode */
[data-theme="dark"] .job-title a:hover {
  color: var(--primary-color);
}

[data-theme="dark"] .meta-badge {
  background: rgba(255, 255, 255, 0.05);
}

[data-theme="dark"] .skill-tag {
  background: rgba(255, 255, 255, 0.05);
}

/* Page Header */
.page-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1.5rem;
  background: var(--card-bg);
  border-radius: var(--radius-lg);
  padding: 1.25rem;
  box-shadow: var(--card-shadow);
}

.header-content {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
}

.page-title {
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--gray-800);
  margin: 0;
}

.breadcrumb {
  display: flex;
  align-items: center;
  font-size: 0.875rem;
  color: var(--gray-500);
}

.breadcrumb-link {
  color: var(--primary-color);
  text-decoration: none;
}

.breadcrumb-separator {
  margin: 0 0.5rem;
  display: flex;
  align-items: center;
}

.header-actions {
  display: flex;
  gap: 0.75rem;
}

/* Quick Filter Bar */
.quick-filter-bar {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
  margin-bottom: 1.5rem;
  background: var(--card-bg);
  padding: 1rem;
  border-radius: var(--radius-lg);
  box-shadow: var(--card-shadow);
}
.job-applied-indicator {
  color: var(--success-color);
  margin-left: 0.5rem;
  font-size: 1rem;
}

.application-status-badge {
  padding: 0.25rem 0.75rem;
  border-radius: 2rem;
  font-size: 0.75rem;
  font-weight: 500;
  display: inline-block;
}

.status-pending {
  background-color: rgba(243, 156, 18, 0.15);
  color: #f39c12;
}

.status-reviewed {
  background-color: rgba(52, 152, 219, 0.15);
  color: #2980b9;
}

.status-interview {
  background-color: rgba(155, 89, 182, 0.15);
  color: #9b59b6;
}

.status-accepted {
  background-color: rgba(46, 204, 113, 0.15);
  color: #27ae60;
}

.status-rejected {
  background-color: rgba(231, 76, 60, 0.15);
  color: #e74c3c;
}

.status-withdrawn {
  background-color: rgba(149, 165, 166, 0.15);
  color: #95a5a6;
}

.search-container {
  flex: 1;
  min-width: 250px;
}

.search-input {
  position: relative;
  width: 100%;
}

.search-input input {
  width: 100%;
  padding: 0.75rem 1rem 0.75rem 2.5rem;
  border-radius: var(--radius-md);
  border: 1px solid var(--gray-200);
  background: var(--gray-50);
  color: var(--gray-800);
  font-size: 0.95rem;
  transition: var(--transition);
}

.search-input input:focus {
  outline: none;
  border-color: var(--primary-color);
  box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.15);
}

.search-input i {
  position: absolute;
  left: 0.75rem;
  top: 50%;
  transform: translateY(-50%);
  color: var(--gray-500);
  font-size: 1.1rem;
}

.filter-dropdowns {
  display: flex;
  gap: 1rem;
  flex-wrap: wrap;
}

.filter-dropdown {
  min-width: 180px;
}

.filter-dropdown select {
  width: 100%;
  padding: 0.75rem 1rem;
  border-radius: var(--radius-md);
  border: 1px solid var(--gray-200);
  background: var(--gray-50);
  color: var(--gray-700);
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 1rem center;
  background-size: 1rem;
  transition: var(--transition);
}

.filter-dropdown select:focus {
  outline: none;
  border-color: var(--primary-color);
  box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.15);
}

/* Content Sections */
.content-section {
  background: var(--card-bg);
  border-radius: var(--radius-lg);
  margin-bottom: 1.5rem;
  padding: 1.5rem;
  box-shadow: var(--card-shadow);
}

.section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1.5rem;
}

.section-title-container {
  display: flex;
  flex-direction: column;
}

.section-title {
  margin: 0;
  font-size: 1.25rem;
  font-weight: 600;
  color: var(--gray-800);
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.section-subtitle {
  margin-top: 0.25rem;
  font-size: 0.875rem;
  color: var(--gray-500);
}

/* Recommended Jobs Grid */
.recommended-section {
  border-left: 4px solid var(--primary-color);
}

.job-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 1.25rem;
}

/* Job Card Styling */
.job-card {
  background: var(--card-bg);
  border-radius: var(--radius-lg);
  overflow: hidden;
  border: 1px solid var(--gray-200);
  box-shadow: var(--card-shadow);
  transition: var(--transition);
  display: flex;
  flex-direction: column;
  height: 100%;
}

.job-card:hover {
  box-shadow: var(--card-shadow-hover);
  transform: translateY(-4px);
}

.job-card-highlighted {
  border-top: 3px solid var(--primary-color);
}

.job-card-top {
  flex: 1;
  padding: 1.25rem;
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.job-card-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
}

.job-title-container {
  flex: 1;
}

.job-title {
  margin: 0;
  font-size: 1.1rem;
  font-weight: 600;
  color: var(--gray-800);
  line-height: 1.4;
}

.job-company {
  margin: 0.25rem 0 0;
  font-size: 0.95rem;
  color: var(--gray-600);
}

.job-match-score {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 3rem;
  height: 3rem;
  background: var(--primary-light);
  border-radius: 50%;
  color: var(--primary-color);
  font-weight: 700;
  margin-left: 0.75rem;
  position: relative;
}

.match-percent {
  font-size: 0.95rem;
}

.match-percent:after {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  border-radius: 50%;
  border: 3px solid var(--primary-color);
  border-top-color: transparent;
  transform: rotate(-45deg);
}

.job-details {
  display: flex;
  flex-direction: column;
  gap: 0.625rem;
}

.job-detail-item {
  display: flex;
  align-items: center;
  gap: 0.625rem;
  font-size: 0.9rem;
  color: var(--gray-600);
}

.job-detail-item i {
  font-size: 1.1rem;
  color: var(--gray-500);
  min-width: 1.1rem;
}

.job-skills {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  margin-top: 0.5rem;
}

.skill-tag {
  padding: 0.25rem 0.75rem;
  background: var(--gray-100);
  border-radius: 2rem;
  font-size: 0.75rem;
  color: var(--gray-700);
}

.more-skills {
  padding: 0.25rem 0.75rem;
  border-radius: 2rem;
  font-size: 0.75rem;
  color: var(--gray-500);
  background: transparent;
  border: 1px dashed var(--gray-300);
}

.job-reason {
  margin-top: auto;
  padding: 0.75rem;
  background: var(--gray-50);
  border-radius: var(--radius-md);
  display: flex;
  gap: 0.75rem;
  align-items: flex-start;
}

.job-reason i {
  color: var(--primary-color);
  font-size: 1.2rem;
  margin-top: 0.1rem;
}

.job-reason p {
  margin: 0;
  font-size: 0.875rem;
  color: var(--gray-600);
  line-height: 1.5;
}

.job-card-footer {
  padding: 1rem 1.25rem;
  border-top: 1px solid var(--gray-200);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

/* Tab Navigation */
.tab-navigation {
  display: flex;
  gap: 0.5rem;
  border-bottom: 1px solid var(--gray-200);
  margin-bottom: 1.5rem;
  overflow-x: auto;
  scrollbar-width: none;
  padding-bottom: 0.5rem;
}

.tab-navigation::-webkit-scrollbar {
  display: none;
}

.tab-button {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.75rem 1.25rem;
  background: transparent;
  border: none;
  color: var(--gray-600);
  font-weight: 500;
  font-size: 0.95rem;
  cursor: pointer;
  transition: var(--transition);
  border-radius: var(--radius-md);
  white-space: nowrap;
}

.tab-button:hover {
  background: var(--gray-100);
  color: var(--gray-800);
}

.tab-button.active {
  background: var(--primary-light);
  color: var(--primary-color);
  font-weight: 600;
}

.tab-button i {
  font-size: 1.1rem;
}

.tab-content {
  display: none;
}

.tab-content.active {
  display: block;
}

/* Job List Table */
.job-list-container {
  overflow-x: auto;
}

.job-list-table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
}

.job-list-table th {
  background: var(--gray-50);
  color: var(--gray-600);
  font-weight: 600;
  text-align: left;
  padding: 1rem;
  font-size: 0.875rem;
  border-bottom: 1px solid var(--gray-200);
}

.job-list-table tr {
  transition: var(--transition);
}

.job-list-table tr:hover {
  background-color: var(--gray-50);
}

.job-list-table td {
  padding: 1rem;
  border-bottom: 1px solid var(--gray-200);
  font-size: 0.925rem;
  color: var(--gray-700);
}

.job-title-cell {
  position: relative;
  width: 25%;
}

.job-list-title {
  color: var(--primary-color);
  font-weight: 500;
  text-decoration: none;
  transition: var(--transition);
}

.job-list-title:hover {
  color: var(--primary-dark);
  text-decoration: underline;
}

.job-bookmark-indicator {
  color: var(--primary-color);
  margin-left: 0.5rem;
  font-size: 1rem;
}

.job-type-badge {
  padding: 0.25rem 0.75rem;
  border-radius: 2rem;
  font-size: 0.75rem;
  font-weight: 500;
  display: inline-block;
}

.type-full-time {
  background-color: rgba(46, 204, 113, 0.15);
  color: #27ae60;
}

.type-part-time {
  background-color: rgba(52, 152, 219, 0.15);
  color: #2980b9;
}

.type-contract {
  background-color: rgba(243, 156, 18, 0.15);
  color: #f39c12;
}

.type-remote {
  background-color: rgba(67, 97, 238, 0.15);
  color: var(--primary-color);
}

.type-internship {
  background-color: rgba(155, 89, 182, 0.15);
  color: #9b59b6;
}

.job-actions {
  display: flex;
  gap: 0.5rem;
  justify-content: flex-start;
}

/* Empty States */
.empty-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 3rem 1rem;
  text-align: center;
}

.empty-state i {
  font-size: 3rem;
  color: var(--gray-400);
  margin-bottom: 1rem;
}

.empty-state h3 {
  font-size: 1.25rem;
  color: var(--gray-700);
  margin: 0 0 0.5rem;
}

.empty-state p {
  color: var(--gray-500);
  margin-bottom: 1.5rem;
  max-width: 400px;
}

/* Preferences Card */
.preferences-card {
  background: linear-gradient(135deg, var(--primary-light), rgba(67, 97, 238, 0.2));
  border-radius: var(--radius-lg);
  margin-top: 2rem;
  overflow: hidden;
}

.preferences-content {
  display: flex;
  align-items: center;
  gap: 1.5rem;
  padding: 1.5rem;
}

.preferences-icon {
  width: 3.5rem;
  height: 3.5rem;
  min-width: 3.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--primary-color);
  color: white;
}

.preferences-icon i {
  font-size: 1.75rem;
}

.preferences-text {
  flex: 1;
}

.preferences-text h3 {
  margin: 0 0 0.5rem;
  font-size: 1.25rem;
  color: var(--gray-800);
}

.preferences-text p {
  margin: 0;
  color: var(--gray-600);
  font-size: 0.95rem;
  line-height: 1.5;
}

/* Buttons */
.btn {
  padding: 0.625rem 1.25rem;
  border-radius: var(--radius-md);
  font-weight: 500;
  font-size: 0.9rem;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  cursor: pointer;
  transition: var(--transition);
  text-decoration: none;
  border: none;
}

.btn i {
  font-size: 1.1rem;
}

.btn-primary {
  background: var(--primary-color);
  color: #ffffff;
}

.btn-primary:hover {
  background: var(--primary-dark);
  box-shadow: 0 4px 6px rgba(67, 97, 238, 0.2);
}

.btn-light {
  background: var(--gray-100);
  color: var(--gray-700);
}

.btn-light:hover {
  background: var(--gray-200);
}

.btn-outline {
  background: transparent;
  color: var(--text-color);
  border: 1px solid var(--border-color);
}

.btn-outline:hover {
  background: var(--hover-bg);
}

/* Notifications */
.notifications {
  margin-bottom: 1.5rem;
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.notification {
  display: flex;
  align-items: center;
  padding: 1rem;
  border-radius: var(--radius-md);
  background: white;
  box-shadow: var(--card-shadow);
  animation: slideIn 0.3s ease;
}

@keyframes slideIn {
  from { transform: translateY(-20px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}

.notification i {
  font-size: 1.25rem;
  margin-right: 0.75rem;
}

.notification p {
  flex: 1;
  margin: 0;
  font-size: 0.95rem;
}

.notification-success {
  border-left: 4px solid var(--success-color);
}

.notification-success i {
  color: var(--success-color);
}

.notification-error {
  border-left: 4px solid var(--danger-color);
}

.notification-error i {
  color: var(--danger-color);
}

.notification-warning {
  border-left: 4px solid var(--warning-color);
}

.notification-warning i {
  color: var(--warning-color);
}

.notification-info {
  border-left: 4px solid var(--info-color);
}

.notification-info i {
  color: var(--info-color);
}

.notification-close {
  background: transparent;
  border: none;
  color: var(--gray-500);
  cursor: pointer;
  font-size: 1rem;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 2rem;
  height: 2rem;
  border-radius: 50%;
  transition: var(--transition);
}

.notification-close:hover {
  background: var(--gray-100);
  color: var(--gray-700);
}

/* Responsive styles */
@media (max-width: 1024px) {
  .job-grid {
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  }
}

@media (max-width: 768px) {
  .page-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 1rem;
  }
  
  .header-actions {
    width: 100%;
    justify-content: flex-start;
    overflow-x: auto;
    padding-bottom: 0.5rem;
    scrollbar-width: none;
  }
  
  .header-actions::-webkit-scrollbar {
    display: none;
  }
  
  .quick-filter-bar {
    flex-direction: column;
  }
  
  .filter-dropdowns {
    width: 100%;
  }
  
  .filter-dropdown {
    flex: 1;
  }
  
  .job-grid {
    grid-template-columns: 1fr;
  }
  
  .preferences-content {
    flex-direction: column;
    align-items: flex-start;
    text-align: center;
  }
  
  .preferences-icon {
    margin: 0 auto;
  }
  
  .preferences-text {
    text-align: center;
    margin-bottom: 1rem;
  }
}
@media (max-width: 640px) {
  .job-list-table th, .job-list-table td {
    font-size: 0.85rem;
    padding: 0.75rem;
  }
  
  .job-list-title {
    font-size: 1rem;
  }
  
  .job-actions {
    gap: 0.25rem;
  }
}

</style>
<script>
// Document Ready Function
document.addEventListener('DOMContentLoaded', function() {
    // Initialize the location filter with dynamic data
    populateLocationFilter();
    
    // Tab Navigation Functionality
    initTabNavigation();
    
    // Initialize Bookmark Functionality
    initBookmarkButtons();
    
    // Initialize Search Functionality
    initJobSearch();
    
    // Initialize Notification Close Buttons
    initNotificationClose();
    
    // Initialize CSRF token for AJAX requests
    initCSRFToken();
    
    // Theme handling
    const theme = localStorage.getItem('theme') || 'light';
    document.documentElement.setAttribute('data-theme', theme);
    
    // Listen for theme changes
    window.addEventListener('theme-change', function(e) {
        const newTheme = e.detail.theme;
        document.documentElement.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
    });
});

// Initialize CSRF token for AJAX requests
function initCSRFToken() {
    // Get CSRF token from Django
    window.csrfToken = document.querySelector('[name=csrfmiddlewaretoken]')?.value;
    
    // If no token found in form, try to get from cookie
    if (!window.csrfToken) {
        window.csrfToken = getCookie('csrftoken');
    }
}

// Get cookie value by name
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

// Populate Location Filter with unique locations from job listings
function populateLocationFilter() {
    const locationSelect = document.getElementById('location-filter');
    if (!locationSelect) return;
    
    // Get all job locations from the table
    const locationCells = document.querySelectorAll('.job-list-table tbody tr td:nth-child(3)');
    const locations = new Set();
    
    locationCells.forEach(cell => {
        if (cell.textContent.trim()) {
            locations.add(cell.textContent.trim());
        }
    });
    
    // Sort locations alphabetically
    const sortedLocations = Array.from(locations).sort();
    
    // Add options to the select element
    sortedLocations.forEach(location => {
        const option = document.createElement('option');
        option.value = location;
        option.textContent = location;
        locationSelect.appendChild(option);
    });
}

// Tab Navigation Functionality
function initTabNavigation() {
    const tabButtons = document.querySelectorAll('.tab-button');
    
    tabButtons.forEach(button => {
        button.addEventListener('click', function() {
            // Remove active class from all tabs
            tabButtons.forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Add active class to clicked tab
            this.classList.add('active');
            
            // Show corresponding tab content
            const tabId = this.getAttribute('data-tab');
            document.getElementById(`${tabId}-content`).classList.add('active');
            
            // Reinitialize bookmark buttons for the active tab
            setTimeout(() => {
                initBookmarkButtons();
            }, 100);
        });
    });
}

// Switch to a specific tab (helper function)
function switchToTab(tabName) {
    // Remove active class from all tabs
    document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
    });
    
    // Add active class to target tab
    const targetButton = document.querySelector(`[data-tab="${tabName}"]`);
    const targetContent = document.getElementById(`${tabName}-content`);
    
    if (targetButton && targetContent) {
        targetButton.classList.add('active');
        targetContent.classList.add('active');
        
        // Reinitialize bookmark buttons
        setTimeout(() => {
            initBookmarkButtons();
        }, 100);
    }
}

// Initialize Bookmark Buttons with server-side integration
function initBookmarkButtons() {
    const bookmarkButtons = document.querySelectorAll('.bookmark-btn');
    
    bookmarkButtons.forEach(button => {
        // Remove existing event listeners to prevent duplicates
        button.replaceWith(button.cloneNode(true));
    });
    
    // Re-select buttons after cloning
    document.querySelectorAll('.bookmark-btn').forEach(button => {
        initSingleBookmarkButton(button);
    });
}

// Initialize a single bookmark button with server-side integration
function initSingleBookmarkButton(button) {
    button.addEventListener('click', function(e) {
        e.preventDefault();
        
        const jobId = this.getAttribute('data-job-id');
        const isActive = this.classList.contains('active');
        
        // Disable button to prevent double-clicks
        this.disabled = true;
        
        // Send AJAX request to toggle bookmark
        fetch(`/jobs/toggle-bookmark/${jobId}/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': window.csrfToken,
                'Content-Type': 'application/json',
            },
            credentials: 'same-origin'
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Update all bookmark buttons for this job
                updateAllBookmarkButtons(jobId, data.bookmarked);
                
                // Show notification
                showNotification(data.message, data.bookmarked ? 'success' : 'info');
                
                // Handle bookmarked tab updates
                const bookmarkedTab = document.querySelector('.tab-button[data-tab="bookmarked"]');
                const isOnBookmarkedTab = bookmarkedTab && bookmarkedTab.classList.contains('active');

                if (!data.bookmarked) {
                    // Job was unbookmarked - remove from bookmarked tab if present
                    const jobRow = document.querySelector(`#bookmarked-content .job-row[data-job-id="${jobId}"]`);
                    if (jobRow) {
                        jobRow.style.opacity = '0';
                        jobRow.style.transform = 'translateX(-100%)';
                        setTimeout(() => {
                            jobRow.remove();
                            checkBookmarkedTabEmpty();
                        }, 300);
                    }
                } else {
                    // Job was bookmarked - add to bookmarked tab if not present
                    refreshBookmarkedTab(jobId);
                }
            } else {
                showNotification(data.message || 'Error updating bookmark', 'error');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showNotification('Error updating bookmark status', 'error');
        })
        .finally(() => {
            // Re-enable button
            this.disabled = false;
        });
    });
}

// Update all bookmark buttons for a specific job
function updateAllBookmarkButtons(jobId, isBookmarked) {
    const buttons = document.querySelectorAll(`.bookmark-btn[data-job-id="${jobId}"]`);
    
    buttons.forEach(button => {
        if (isBookmarked) {
            button.classList.add('active');
            button.querySelector('i').className = 'bx bxs-bookmark';
            button.setAttribute('title', 'Remove Bookmark');
        } else {
            button.classList.remove('active');
            button.querySelector('i').className = 'bx bx-bookmark';
            button.setAttribute('title', 'Bookmark Job');
        }
    });
    
    // Also update the job row bookmark indicator in all tabs
    const jobTitleCells = document.querySelectorAll(`.job-row[data-job-id="${jobId}"] .job-title-cell`);
    
    jobTitleCells.forEach(cell => {
        const existingIndicator = cell.querySelector('.job-bookmark-indicator');
        
        if (isBookmarked && !existingIndicator) {
            const indicator = document.createElement('i');
            indicator.className = 'bx bxs-bookmark job-bookmark-indicator';
            cell.appendChild(indicator);
        } else if (!isBookmarked && existingIndicator) {
            existingIndicator.remove();
        }
    });
}

// Check if bookmarked tab is empty and show empty state
function checkBookmarkedTabEmpty() {
    const bookmarkedContent = document.getElementById('bookmarked-content');
    const jobRows = bookmarkedContent.querySelectorAll('.job-row');

    if (jobRows.length === 0) {
        bookmarkedContent.innerHTML = `
            <div class="empty-state">
                <i class='bx bx-bookmark'></i>
                <h3>No Bookmarked Jobs Yet</h3>
                <p>Jobs you bookmark will appear here for easy access</p>
                <a href="#" class="btn btn-outline" onclick="switchToTab('all-jobs')">Browse Jobs</a>
            </div>
        `;
    }
}

// Refresh bookmarked tab by fetching updated data
function refreshBookmarkedTab(newJobId = null) {
    const bookmarkedContent = document.getElementById('bookmarked-content');
    if (!bookmarkedContent) return;

    // Show loading state
    const loadingHtml = `
        <div class="loading-state" style="text-align: center; padding: 2rem;">
            <div class="spinner"></div>
            <p>Updating bookmarks...</p>
        </div>
    `;

    // If there's an empty state, replace it with loading
    const emptyState = bookmarkedContent.querySelector('.empty-state');
    if (emptyState) {
        bookmarkedContent.innerHTML = loadingHtml;
    }

    // Fetch updated bookmarked jobs
    fetch('/jobs/bookmarked-jobs-partial/', {
        method: 'GET',
        headers: {
            'X-Requested-With': 'XMLHttpRequest',
            'Content-Type': 'application/json',
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            bookmarkedContent.innerHTML = data.html;
            // Reinitialize bookmark buttons for the new content
            setTimeout(() => {
                initBookmarkButtons();
            }, 100);
        } else {
            console.error('Failed to refresh bookmarked tab');
        }
    })
    .catch(error => {
        console.error('Error refreshing bookmarked tab:', error);
        // Fallback: just reload the page
        window.location.reload();
    });
}

// Show notification
function showNotification(message, type = 'info') {
    let notificationsContainer = document.querySelector('.notifications');
    
    if (!notificationsContainer) {
        // Create notifications container if it doesn't exist
        const container = document.createElement('div');
        container.className = 'notifications';
        
        // Insert after page header
        const pageHeader = document.querySelector('.page-header');
        if (pageHeader) {
            pageHeader.parentNode.insertBefore(container, pageHeader.nextSibling);
            notificationsContainer = container;
        } else {
            // Fallback: insert at the beginning of the body
            document.body.insertBefore(container, document.body.firstChild);
            notificationsContainer = container;
        }
    }
    
    // Create notification element
    const notification = document.createElement('div');
    notification.className = `notification notification-${type}`;
    
    // Set icon based on type
    let icon = 'bx-info-circle';
    if (type === 'success') icon = 'bx-check-circle';
    if (type === 'error') icon = 'bx-error';
    if (type === 'warning') icon = 'bx-error-circle';
    
    // Set notification content
    notification.innerHTML = `
        <i class='bx ${icon}'></i>
        <p>${message}</p>
        <button class="notification-close"><i class='bx bx-x'></i></button>
    `;
    
    // Add to container
    notificationsContainer.appendChild(notification);
    
    // Auto-hide after 5 seconds
    setTimeout(() => {
        hideNotification(notification);
    }, 5000);
    
    // Add close button functionality
    const closeButton = notification.querySelector('.notification-close');
    closeButton.addEventListener('click', function() {
        hideNotification(notification);
    });
}

// Hide notification with animation
function hideNotification(notification) {
    notification.style.opacity = '0';
    notification.style.transform = 'translateY(-20px)';
    setTimeout(() => {
        if (notification.parentNode) {
            notification.remove();
        }
    }, 300);
}

// Initialize notification close buttons
function initNotificationClose() {
    document.querySelectorAll('.notification-close').forEach(button => {
        button.addEventListener('click', function() {
            const notification = this.closest('.notification');
            hideNotification(notification);
        });
    });
}

// Initialize Job Search Functionality
function initJobSearch() {
    const searchInput = document.getElementById('job-search');
    const locationFilter = document.getElementById('location-filter');
    const jobTypeFilter = document.getElementById('job-type-filter');
    
    if (!searchInput || !locationFilter || !jobTypeFilter) return;
    
    // Search and filter function
    function filterJobs() {
        const searchTerm = searchInput.value.toLowerCase();
        const locationTerm = locationFilter.value.toLowerCase();
        const jobTypeTerm = jobTypeFilter.value.toLowerCase();
        
        // Only filter jobs in the "All Jobs" tab
        const allJobsContent = document.getElementById('all-jobs-content');
        if (!allJobsContent) return;
        
        const jobRows = allJobsContent.querySelectorAll('.job-row');
        let visibleCount = 0;
        
        jobRows.forEach(row => {
            const cells = row.querySelectorAll('td');
            if (cells.length < 4) return; // Skip if not enough cells
            
            const jobTitle = cells[0].textContent.toLowerCase();
            const company = cells[1].textContent.toLowerCase();
            const location = cells[2].textContent.toLowerCase();
            const jobType = cells[3].textContent.toLowerCase();
            
            // Check if job matches all filters
            const matchesSearch = searchTerm === '' || 
                jobTitle.includes(searchTerm) || 
                company.includes(searchTerm);
                
            const matchesLocation = locationTerm === '' || location.includes(locationTerm);
            const matchesJobType = jobTypeTerm === '' || jobType.includes(jobTypeTerm);
            
            // Show/hide based on filter criteria
            if (matchesSearch && matchesLocation && matchesJobType) {
                row.style.display = '';
                visibleCount++;
            } else {
                row.style.display = 'none';
            }
        });
        
        // Handle empty state
        handleFilterEmptyState(allJobsContent, visibleCount);
    }
    
    // Handle empty state for filtered results
    function handleFilterEmptyState(container, visibleCount) {
        const existingEmptyState = container.querySelector('.filter-empty-state');
        
        if (visibleCount === 0) {
            if (!existingEmptyState) {
                const tbody = container.querySelector('.job-list-table tbody');
                if (tbody) {
                    const emptyRow = document.createElement('tr');
                    emptyRow.className = 'filter-empty-state';
                    emptyRow.innerHTML = `
                        <td colspan="6">
                            <div class="empty-state">
                                <i class='bx bx-search-alt'></i>
                                <p>No jobs found matching your criteria</p>
                                <button id="clear-filters" class="btn btn-outline">Clear Filters</button>
                            </div>
                        </td>
                    `;
                    tbody.appendChild(emptyRow);
                    
                    // Add event listener to clear filters button
                    document.getElementById('clear-filters').addEventListener('click', clearFilters);
                }
            }
        } else if (existingEmptyState) {
            existingEmptyState.remove();
        }
    }
    
    // Clear filters function
    function clearFilters() {
        searchInput.value = '';
        locationFilter.value = '';
        jobTypeFilter.value = '';
        
        // Trigger filter update
        filterJobs();
        
        // Remove empty state if it exists
        const existingEmptyState = document.querySelector('.filter-empty-state');
        if (existingEmptyState) {
            existingEmptyState.remove();
        }
    }
    
    // Debounce function for search input
    function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }
    
    // Add event listeners with debouncing for search
    const debouncedFilter = debounce(filterJobs, 300);
    searchInput.addEventListener('input', debouncedFilter);
    locationFilter.addEventListener('change', filterJobs);
    jobTypeFilter.addEventListener('change', filterJobs);
}

// Utility function to format relative time
function timeAgo(date) {
    const now = new Date();
    const diffTime = Math.abs(now - new Date(date));
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    
    if (diffDays === 1) return '1 day ago';
    if (diffDays < 7) return `${diffDays} days ago`;
    if (diffDays < 30) return `${Math.ceil(diffDays / 7)} weeks ago`;
    return `${Math.ceil(diffDays / 30)} months ago`;
}

// Handle page visibility change to refresh data when tab becomes visible
document.addEventListener('visibilitychange', function() {
    if (!document.hidden) {
        // Page became visible, reinitialize bookmark buttons
        setTimeout(() => {
            initBookmarkButtons();
        }, 100);
    }
});

// Handle browser back/forward buttons
window.addEventListener('popstate', function(event) {
    // Reinitialize everything when navigating back/forward
    setTimeout(() => {
        initBookmarkButtons();
        populateLocationFilter();
    }, 100);
});

// Global error handler for unhandled promise rejections
window.addEventListener('unhandledrejection', function(event) {
    console.error('Unhandled promise rejection:', event.reason);
    showNotification('An error occurred. Please try again.', 'error');
});
</script>
{% endblock %}