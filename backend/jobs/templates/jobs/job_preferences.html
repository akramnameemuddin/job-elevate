{% extends 'dashboard/base.html' %}
{% load static %}

{% block title %}Job Preferences | Job Elevate{% endblock %}

{% block content %}
<div class="page-container">
    <!-- Breadcrumb Navigation -->
    <nav class="breadcrumb-nav">
        <a href="{% url 'dashboard:home' %}" class="breadcrumb-link">Home</a>
        <i class='bx bx-chevron-right'></i>
        <a href="{% url 'jobs:job_listings' %}" class="breadcrumb-link">Jobs</a>
        <i class='bx bx-chevron-right'></i>
        <span class="breadcrumb-current">Preferences</span>
    </nav>

    <!-- Page Header -->
    <div class="page-header">
        <div class="page-header-content">
            <h1 class="page-title">Job Preferences</h1>
            <p class="page-subtitle">Customize your job search preferences to get better recommendations</p>
        </div>
        <div class="page-actions">
            <a href="{% url 'jobs:recommended_jobs' %}" class="btn btn-outline-primary">
                <i class='bx bx-arrow-back'></i>
                Back to Jobs
            </a>
        </div>
    </div>

    <!-- Messages -->
    {% if messages %}
    <div class="messages-container">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags|default:'info' }}">
            <div class="alert-content">
                {% if message.tags == 'success' %}
                <i class='bx bx-check-circle'></i>
                {% elif message.tags == 'error' %}
                <i class='bx bx-error'></i>
                {% elif message.tags == 'warning' %}
                <i class='bx bx-error-circle'></i>
                {% else %}
                <i class='bx bx-info-circle'></i>
                {% endif %}
                <span>{{ message }}</span>
            </div>
            <button type="button" class="alert-close" onclick="this.parentElement.remove()">
                <i class='bx bx-x'></i>
            </button>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Preferences Form -->
    <div class="content-card">
        <form method="POST" action="{% url 'jobs:update_job_preferences' %}" class="preferences-form" id="preferences-form">
            {% csrf_token %}

            <div class="form-sections">
                <!-- Job Types Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h2 class="section-title">
                            <i class='bx bx-briefcase'></i>
                            Job Types
                        </h2>
                        <p class="section-description">Select the types of employment you're interested in</p>
                    </div>

                    <div class="form-group">
                        <div class="checkbox-grid">
                            {% for value, label in job_types.items %}
                            <label class="checkbox-card">
                                <input type="checkbox" name="preferred_job_types" value="{{ value }}"
                                    {% if preferences and value in preferences.preferred_job_types %}checked{% endif %}>
                                <div class="checkbox-content">
                                    <i class='bx {% if value == "Full-time" %}bx-time{% elif value == "Part-time" %}bx-time-five{% elif value == "Contract" %}bx-file-blank{% elif value == "Freelance" %}bx-user{% elif value == "Internship" %}bx-graduation{% else %}bx-briefcase{% endif %}'></i>
                                    <span>{{ label }}</span>
                                    <div class="checkbox-indicator">
                                        <i class='bx bx-check'></i>
                                    </div>
                                </div>
                            </label>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Remote Work Preference -->
                    <div class="form-group">
                        <div class="toggle-group">
                            <div class="toggle-info">
                                <label for="remote-preference" class="toggle-label">
                                    <i class='bx bx-home'></i>
                                    Remote Work Preference
                                </label>
                                <p class="toggle-description">Prioritize remote and work-from-home opportunities</p>
                            </div>
                            <div class="toggle-switch">
                                <input type="checkbox" name="remote_preference" id="remote-preference"
                                    {% if preferences and preferences.remote_preference %}checked{% endif %}>
                                <label for="remote-preference" class="switch">
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Location Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h2 class="section-title">
                            <i class='bx bx-map-pin'></i>
                            Preferred Locations
                        </h2>
                        <p class="section-description">Add cities, states, or countries where you'd like to work</p>
                    </div>

                    <div class="form-group">
                        <div class="input-group">
                            <input type="text" id="location-input" placeholder="Enter location (e.g., New York, NY)" class="form-control">
                            <button type="button" class="btn btn-primary" id="add-location">
                                <i class='bx bx-plus'></i>
                                Add
                            </button>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="tags-container" id="location-tags">
                            {% if preferences and preferences.preferred_locations %}
                                {% for location in preferences.preferred_locations %}
                                <span class="tag">
                                    <i class='bx bx-map'></i>
                                    {{ location }}
                                    <button type="button" class="tag-remove" data-value="{{ location }}">
                                        <i class='bx bx-x'></i>
                                    </button>
                                </span>
                                {% endfor %}
                            {% endif %}
                        </div>
                    </div>

                    <!-- Hidden input for locations -->
                    <input type="hidden" name="preferred_locations" id="locations-input"
                           value="{% if preferences and preferences.preferred_locations %}{{ preferences.preferred_locations|join:',' }}{% endif %}">
                </div>

                <!-- Salary Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h2 class="section-title">
                            <i class='bx bx-dollar-circle'></i>
                            Salary Expectations
                        </h2>
                        <p class="section-description">Set your minimum expected annual salary (USD)</p>
                    </div>

                    <div class="form-group">
                        <label for="salary-input" class="form-label">Minimum Annual Salary</label>
                        <div class="salary-input-container">
                            <div class="salary-display">
                                <span class="currency">$</span>
                                <span class="salary-amount" id="salary-display">{{ preferences.min_salary_expectation|default:50000 }}</span>
                                <span class="salary-period">per year</span>
                            </div>

                            <div class="range-slider">
                                <input type="range" id="salary-slider" name="min_salary_expectation"
                                    min="25000" max="200000" step="5000"
                                    value="{{ preferences.min_salary_expectation|default:50000 }}"
                                    class="slider">
                                <div class="slider-labels">
                                    <span>$25K</span>
                                    <span>$200K+</span>
                                </div>
                            </div>
                        </div>

                        <!-- Quick salary presets -->
                        <div class="salary-presets">
                            <label class="form-label">Quick select:</label>
                            <div class="preset-buttons">
                                <button type="button" class="btn btn-outline-secondary btn-sm preset-btn" data-salary="40000">$40K</button>
                                <button type="button" class="btn btn-outline-secondary btn-sm preset-btn" data-salary="60000">$60K</button>
                                <button type="button" class="btn btn-outline-secondary btn-sm preset-btn" data-salary="80000">$80K</button>
                                <button type="button" class="btn btn-outline-secondary btn-sm preset-btn" data-salary="100000">$100K</button>
                                <button type="button" class="btn btn-outline-secondary btn-sm preset-btn" data-salary="120000">$120K</button>
                                <button type="button" class="btn btn-outline-secondary btn-sm preset-btn" data-salary="150000">$150K</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Industry Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h2 class="section-title">
                            <i class='bx bx-buildings'></i>
                            Industry Preferences
                        </h2>
                        <p class="section-description">Select industries that interest you most</p>
                    </div>

                    <div class="form-group">
                        <div class="industry-grid">
                            {% for industry, label in industry_choices %}
                            <button type="button" class="industry-card" data-industry="{{ industry }}">
                                <div class="industry-icon">
                                    {% if industry == "Technology" %}
                                        <i class='bx bx-code-alt'></i>
                                    {% elif industry == "Healthcare" %}
                                        <i class='bx bx-health'></i>
                                    {% elif industry == "Finance" %}
                                        <i class='bx bx-money'></i>
                                    {% elif industry == "Education" %}
                                        <i class='bx bx-book-reader'></i>
                                    {% elif industry == "Marketing" %}
                                        <i class='bx bx-trending-up'></i>
                                    {% elif industry == "Manufacturing" %}
                                        <i class='bx bx-cog'></i>
                                    {% elif industry == "Retail" %}
                                        <i class='bx bx-store'></i>
                                    {% elif industry == "Media" %}
                                        <i class='bx bx-camera'></i>
                                    {% elif industry == "Construction" %}
                                        <i class='bx bx-building'></i>
                                    {% elif industry == "Transportation" %}
                                        <i class='bx bx-car'></i>
                                    {% elif industry == "Food Service" %}
                                        <i class='bx bx-restaurant'></i>
                                    {% else %}
                                        <i class='bx bx-briefcase'></i>
                                    {% endif %}
                                </div>
                                <span class="industry-name">{{ label }}</span>
                                <div class="industry-check">
                                    <i class='bx bx-check'></i>
                                </div>
                            </button>
                            {% endfor %}
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="input-group">
                            <input type="text" id="industry-input" placeholder="Add custom industry..." class="form-control">
                            <button type="button" class="btn btn-primary" id="add-industry">
                                <i class='bx bx-plus'></i>
                                Add
                            </button>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="tags-container" id="industry-tags">
                            {% if preferences and preferences.industry_preferences %}
                                {% for industry in preferences.industry_preferences %}
                                <span class="tag">
                                    <i class='bx bx-building'></i>
                                    {{ industry }}
                                    <button type="button" class="tag-remove" data-value="{{ industry }}">
                                        <i class='bx bx-x'></i>
                                    </button>
                                </span>
                                {% endfor %}
                            {% endif %}
                        </div>
                    </div>

                    <!-- Hidden input for industries -->
                    <input type="hidden" name="industry_preferences" id="industries-input"
                           value="{% if preferences and preferences.industry_preferences %}{{ preferences.industry_preferences|join:',' }}{% endif %}">
                </div>

            </div>

            <!-- Form Actions -->
            <div class="form-actions">
                <button type="button" class="btn btn-outline-secondary" onclick="window.history.back()">
                    <i class='bx bx-arrow-back'></i>
                    Cancel
                </button>
                <button type="submit" class="btn btn-primary">
                    <i class='bx bx-save'></i>
                    Save Preferences
                </button>
            </div>
        </form>
    </div>
</div>

<style>
/* Job Preferences Page Styles */
.page-container {
    background: #ffffff;
    min-height: 100vh;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
}

/* Breadcrumb Navigation */
.breadcrumb-nav {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 1rem 2rem;
    background: #ffffff;
    border-bottom: 1px solid #e5e7eb;
    font-size: 0.875rem;
}

.breadcrumb-link {
    color: #6b7280;
    text-decoration: none;
    transition: color 0.2s ease;
}

.breadcrumb-link:hover {
    color: #1f2937;
}

.breadcrumb-current {
    color: #1f2937;
    font-weight: 500;
}

.breadcrumb-nav i {
    color: #9ca3af;
    font-size: 0.75rem;
}

/* Page Header */
.page-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    padding: 2rem;
    background: #ffffff;
    border-bottom: 1px solid #e5e7eb;
}

.page-header-content h1 {
    font-size: 1.875rem;
    font-weight: 600;
    color: #1f2937;
    margin: 0 0 0.5rem 0;
}

.page-header-content p {
    color: #6b7280;
    margin: 0;
    font-size: 1rem;
}

/* Messages */
.messages-container {
    padding: 1rem 2rem 0;
}

.alert {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.75rem 1rem;
    border-radius: 0.5rem;
    margin-bottom: 1rem;
    border: 1px solid;
}

.alert-success {
    background: #f0fdf4;
    border-color: #bbf7d0;
    color: #166534;
}

.alert-error {
    background: #fef2f2;
    border-color: #fecaca;
    color: #dc2626;
}

.alert-warning {
    background: #fffbeb;
    border-color: #fed7aa;
    color: #d97706;
}

.alert-info {
    background: #eff6ff;
    border-color: #bfdbfe;
    color: #2563eb;
}

.alert-content {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.alert-close {
    background: none;
    border: none;
    color: inherit;
    cursor: pointer;
    padding: 0.25rem;
    border-radius: 0.25rem;
    opacity: 0.7;
    transition: opacity 0.2s ease;
}

.alert-close:hover {
    opacity: 1;
}

/* Content Card */
.content-card {
    background: #ffffff;
    border-radius: 0.75rem;
    box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
    margin: 2rem;
    overflow: hidden;
}

/* Form Sections */
.form-sections {
    padding: 2rem;
}

.form-section {
    margin-bottom: 3rem;
}

.form-section:last-child {
    margin-bottom: 0;
}

.section-header {
    margin-bottom: 1.5rem;
}

.section-title {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 1.25rem;
    font-weight: 600;
    color: #1f2937;
    margin: 0 0 0.5rem 0;
}

.section-title i {
    color: #3b82f6;
}

.section-description {
    color: #6b7280;
    margin: 0;
    font-size: 0.875rem;
}

/* Form Groups */
.form-group {
    margin-bottom: 1.5rem;
}

.form-label {
    display: block;
    font-weight: 500;
    color: #374151;
    margin-bottom: 0.5rem;
    font-size: 0.875rem;
}

.form-control {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid #d1d5db;
    border-radius: 0.5rem;
    font-size: 0.875rem;
    transition: border-color 0.2s ease, box-shadow 0.2s ease;
}

.form-control:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

/* Input Groups */
.input-group {
    display: flex;
    gap: 0.5rem;
}

.input-group .form-control {
    flex: 1;
}

/* Checkbox Grid */
.checkbox-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
}

.checkbox-card {
    position: relative;
    cursor: pointer;
    border: 2px solid #e5e7eb;
    border-radius: 0.75rem;
    padding: 1rem;
    transition: all 0.2s ease;
    background: #ffffff;
}

.checkbox-card:hover {
    border-color: #3b82f6;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
}

.checkbox-card input[type="checkbox"] {
    position: absolute;
    opacity: 0;
    pointer-events: none;
}

.checkbox-card input[type="checkbox"]:checked + .checkbox-content {
    color: #3b82f6;
}

.checkbox-card input[type="checkbox"]:checked + .checkbox-content .checkbox-indicator {
    opacity: 1;
    transform: scale(1);
}

.checkbox-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
    text-align: center;
    position: relative;
}

.checkbox-content i {
    font-size: 1.5rem;
    color: #6b7280;
    transition: color 0.2s ease;
}

.checkbox-content span {
    font-weight: 500;
    color: #374151;
    transition: color 0.2s ease;
}

.checkbox-indicator {
    position: absolute;
    top: -0.5rem;
    right: -0.5rem;
    width: 1.5rem;
    height: 1.5rem;
    background: #3b82f6;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 0.75rem;
    opacity: 0;
    transform: scale(0.8);
    transition: all 0.2s ease;
}

/* Toggle Switch */
.toggle-group {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
    border: 1px solid #e5e7eb;
    border-radius: 0.75rem;
    background: #f9fafb;
}

.toggle-info .toggle-label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-weight: 500;
    color: #374151;
    margin-bottom: 0.25rem;
}

.toggle-description {
    color: #6b7280;
    font-size: 0.875rem;
    margin: 0;
}

.toggle-switch {
    position: relative;
}

.toggle-switch input[type="checkbox"] {
    opacity: 0;
    position: absolute;
}

.switch {
    position: relative;
    display: inline-block;
    width: 3rem;
    height: 1.5rem;
    cursor: pointer;
}

.slider {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #d1d5db;
    transition: 0.3s;
    border-radius: 1.5rem;
}

.slider:before {
    position: absolute;
    content: "";
    height: 1.25rem;
    width: 1.25rem;
    left: 0.125rem;
    bottom: 0.125rem;
    background-color: white;
    transition: 0.3s;
    border-radius: 50%;
}

input:checked + .switch .slider {
    background-color: #3b82f6;
}

input:checked + .switch .slider:before {
    transform: translateX(1.5rem);
}

/* Salary Input */
.salary-input-container {
    background: #f9fafb;
    border: 1px solid #e5e7eb;
    border-radius: 0.75rem;
    padding: 1.5rem;
}

.salary-display {
    text-align: center;
    margin-bottom: 1.5rem;
}

.currency {
    font-size: 1.25rem;
    color: #6b7280;
}

.salary-amount {
    font-size: 2rem;
    font-weight: 600;
    color: #1f2937;
    margin: 0 0.25rem;
}

.salary-period {
    font-size: 0.875rem;
    color: #6b7280;
}

.range-slider {
    margin-bottom: 1rem;
}

.slider {
    width: 100%;
    height: 0.5rem;
    border-radius: 0.25rem;
    background: #e5e7eb;
    outline: none;
    -webkit-appearance: none;
}

.slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 1.25rem;
    height: 1.25rem;
    border-radius: 50%;
    background: #3b82f6;
    cursor: pointer;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.slider::-moz-range-thumb {
    width: 1.25rem;
    height: 1.25rem;
    border-radius: 50%;
    background: #3b82f6;
    cursor: pointer;
    border: none;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.slider-labels {
    display: flex;
    justify-content: space-between;
    margin-top: 0.5rem;
    font-size: 0.75rem;
    color: #6b7280;
}

.salary-presets {
    margin-top: 1rem;
}

.preset-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-top: 0.5rem;
}

/* Industry Grid */
.industry-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
    margin-bottom: 1.5rem;
}

.industry-card {
    position: relative;
    background: #ffffff;
    border: 2px solid #e5e7eb;
    border-radius: 0.75rem;
    padding: 1rem;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
    text-align: center;
}

.industry-card:hover {
    border-color: #3b82f6;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
}

.industry-card.selected {
    border-color: #3b82f6;
    background: #eff6ff;
}

.industry-icon {
    font-size: 1.5rem;
    color: #6b7280;
    transition: color 0.2s ease;
}

.industry-card.selected .industry-icon {
    color: #3b82f6;
}

.industry-name {
    font-weight: 500;
    color: #374151;
    font-size: 0.875rem;
}

.industry-card.selected .industry-name {
    color: #3b82f6;
}

.industry-check {
    position: absolute;
    top: -0.5rem;
    right: -0.5rem;
    width: 1.5rem;
    height: 1.5rem;
    background: #3b82f6;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 0.75rem;
    opacity: 0;
    transform: scale(0.8);
    transition: all 0.2s ease;
}

.industry-card.selected .industry-check {
    opacity: 1;
    transform: scale(1);
}

/* Tags */
.tags-container {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    min-height: 2.5rem;
    padding: 0.5rem;
    border: 1px solid #e5e7eb;
    border-radius: 0.5rem;
    background: #f9fafb;
}

.tag {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    background: #3b82f6;
    color: white;
    padding: 0.25rem 0.5rem;
    border-radius: 0.375rem;
    font-size: 0.75rem;
    font-weight: 500;
}

.tag-remove {
    background: none;
    border: none;
    color: white;
    cursor: pointer;
    padding: 0;
    margin-left: 0.25rem;
    border-radius: 50%;
    width: 1rem;
    height: 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.2s ease;
}

.tag-remove:hover {
    background: rgba(255, 255, 255, 0.2);
}

/* Form Actions */
.form-actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem 2rem;
    background: #f9fafb;
    border-top: 1px solid #e5e7eb;
}

/* Buttons */
.btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    border-radius: 0.5rem;
    font-weight: 500;
    font-size: 0.875rem;
    text-decoration: none;
    border: 1px solid;
    cursor: pointer;
    transition: all 0.2s ease;
}

.btn-primary {
    background: #3b82f6;
    border-color: #3b82f6;
    color: white;
}

.btn-primary:hover {
    background: #2563eb;
    border-color: #2563eb;
}

.btn-outline-primary {
    background: transparent;
    border-color: #3b82f6;
    color: #3b82f6;
}

.btn-outline-primary:hover {
    background: #3b82f6;
    color: white;
}

.btn-outline-secondary {
    background: transparent;
    border-color: #d1d5db;
    color: #6b7280;
}

.btn-outline-secondary:hover {
    background: #f3f4f6;
    border-color: #9ca3af;
}

.btn-sm {
    padding: 0.5rem 1rem;
    font-size: 0.75rem;
}

/* Responsive Design */
@media (max-width: 768px) {
    .page-header {
        flex-direction: column;
        gap: 1rem;
        align-items: stretch;
    }

    .checkbox-grid {
        grid-template-columns: 1fr;
    }

    .industry-grid {
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    }

    .form-actions {
        flex-direction: column;
        gap: 1rem;
    }

    .preset-buttons {
        justify-content: center;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize all functionality
    initializeSalarySlider();
    initializeLocationInput();
    initializeIndustrySelection();
    initializeFormValidation();

    // Salary slider functionality
    function initializeSalarySlider() {
        const slider = document.getElementById('salary-slider');
        const display = document.getElementById('salary-display');
        const presetButtons = document.querySelectorAll('.preset-btn');

        if (slider && display) {
            slider.addEventListener('input', function() {
                const value = parseInt(this.value);
                display.textContent = formatSalary(value);
            });

            // Preset button functionality
            presetButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const salary = parseInt(this.dataset.salary);
                    slider.value = salary;
                    display.textContent = formatSalary(salary);

                    // Update button states
                    presetButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                });
            });
        }
    }

    function formatSalary(value) {
        return new Intl.NumberFormat('en-US').format(value);
    }

    // Location input functionality
    function initializeLocationInput() {
        const input = document.getElementById('location-input');
        const addBtn = document.getElementById('add-location');
        const tagsContainer = document.getElementById('location-tags');
        const hiddenInput = document.getElementById('locations-input');

        if (!input || !addBtn || !tagsContainer || !hiddenInput) return;

        function addLocation() {
            const value = input.value.trim();
            if (value && !isLocationExists(value)) {
                createLocationTag(value);
                input.value = '';
                updateHiddenInput();
            } else if (isLocationExists(value)) {
                showAlert('This location is already added.', 'warning');
            }
        }

        function isLocationExists(location) {
            const existingTags = tagsContainer.querySelectorAll('.tag');
            return Array.from(existingTags).some(tag =>
                tag.textContent.trim().toLowerCase() === location.toLowerCase()
            );
        }

        function createLocationTag(location) {
            const tag = document.createElement('span');
            tag.className = 'tag';
            tag.innerHTML = `
                <i class='bx bx-map'></i>
                ${location}
                <button type="button" class="tag-remove" data-value="${location}">
                    <i class='bx bx-x'></i>
                </button>
            `;

            tag.querySelector('.tag-remove').addEventListener('click', function() {
                tag.remove();
                updateHiddenInput();
            });

            tagsContainer.appendChild(tag);
        }

        function updateHiddenInput() {
            const tags = tagsContainer.querySelectorAll('.tag');
            const locations = Array.from(tags).map(tag => {
                const text = tag.textContent.trim();
                return text.substring(0, text.length - 1); // Remove the 'x' from the end
            });
            hiddenInput.value = locations.join(',');
        }

        addBtn.addEventListener('click', addLocation);
        input.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                addLocation();
            }
        });

        // Initialize existing tag remove buttons
        tagsContainer.querySelectorAll('.tag-remove').forEach(button => {
            button.addEventListener('click', function() {
                this.closest('.tag').remove();
                updateHiddenInput();
            });
        });
    }

    // Industry selection functionality
    function initializeIndustrySelection() {
        const industryCards = document.querySelectorAll('.industry-card');
        const industryInput = document.getElementById('industry-input');
        const addIndustryBtn = document.getElementById('add-industry');
        const tagsContainer = document.getElementById('industry-tags');
        const hiddenInput = document.getElementById('industries-input');

        // Industry card selection
        industryCards.forEach(card => {
            card.addEventListener('click', function() {
                const industry = this.dataset.industry;
                if (this.classList.contains('selected')) {
                    this.classList.remove('selected');
                    removeIndustryTag(industry);
                } else {
                    this.classList.add('selected');
                    if (!isIndustryExists(industry)) {
                        createIndustryTag(industry);
                    }
                }
                updateIndustryHiddenInput();
            });
        });

        // Custom industry input
        if (industryInput && addIndustryBtn) {
            function addCustomIndustry() {
                const value = industryInput.value.trim();
                if (value && !isIndustryExists(value)) {
                    createIndustryTag(value);
                    industryInput.value = '';
                    updateIndustryHiddenInput();
                } else if (isIndustryExists(value)) {
                    showAlert('This industry is already added.', 'warning');
                }
            }

            addIndustryBtn.addEventListener('click', addCustomIndustry);
            industryInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    addCustomIndustry();
                }
            });
        }

        function isIndustryExists(industry) {
            const existingTags = tagsContainer.querySelectorAll('.tag');
            return Array.from(existingTags).some(tag =>
                tag.textContent.trim().toLowerCase() === industry.toLowerCase()
            );
        }

        function createIndustryTag(industry) {
            const tag = document.createElement('span');
            tag.className = 'tag';
            tag.innerHTML = `
                <i class='bx bx-building'></i>
                ${industry}
                <button type="button" class="tag-remove" data-value="${industry}">
                    <i class='bx bx-x'></i>
                </button>
            `;

            tag.querySelector('.tag-remove').addEventListener('click', function() {
                tag.remove();
                updateIndustryHiddenInput();

                // Unselect corresponding industry card if exists
                const industryCard = document.querySelector(`[data-industry="${industry}"]`);
                if (industryCard) {
                    industryCard.classList.remove('selected');
                }
            });

            tagsContainer.appendChild(tag);
        }

        function removeIndustryTag(industry) {
            const tags = tagsContainer.querySelectorAll('.tag');
            tags.forEach(tag => {
                const text = tag.textContent.trim();
                const tagIndustry = text.substring(0, text.length - 1); // Remove the 'x'
                if (tagIndustry === industry) {
                    tag.remove();
                }
            });
        }

        function updateIndustryHiddenInput() {
            const tags = tagsContainer.querySelectorAll('.tag');
            const industries = Array.from(tags).map(tag => {
                const text = tag.textContent.trim();
                return text.substring(0, text.length - 1); // Remove the 'x' from the end
            });
            hiddenInput.value = industries.join(',');
        }

        // Initialize existing industry selections
        const existingIndustries = hiddenInput.value.split(',').filter(i => i.trim());
        existingIndustries.forEach(industry => {
            const industryCard = document.querySelector(`[data-industry="${industry.trim()}"]`);
            if (industryCard) {
                industryCard.classList.add('selected');
            }
        });

        // Initialize existing tag remove buttons
        tagsContainer.querySelectorAll('.tag-remove').forEach(button => {
            button.addEventListener('click', function() {
                const industry = this.dataset.value;
                this.closest('.tag').remove();
                updateIndustryHiddenInput();

                // Unselect corresponding industry card
                const industryCard = document.querySelector(`[data-industry="${industry}"]`);
                if (industryCard) {
                    industryCard.classList.remove('selected');
                }
            });
        });
    }

    // Form validation
    function initializeFormValidation() {
        const form = document.getElementById('preferences-form');
        if (form) {
            form.addEventListener('submit', function(e) {
                const jobTypes = document.querySelectorAll('input[name="preferred_job_types"]:checked');
                if (jobTypes.length === 0) {
                    e.preventDefault();
                    showAlert('Please select at least one job type.', 'error');
                    return false;
                }

                showAlert('Saving your preferences...', 'info');
            });
        }
    }

    // Utility function to show alerts
    function showAlert(message, type = 'info') {
        const alertsContainer = document.querySelector('.messages-container') || createAlertsContainer();

        const alert = document.createElement('div');
        alert.className = `alert alert-${type}`;
        alert.innerHTML = `
            <div class="alert-content">
                <i class='bx bx-${type === 'success' ? 'check-circle' : type === 'error' ? 'error' : type === 'warning' ? 'error-circle' : 'info-circle'}'></i>
                <span>${message}</span>
            </div>
            <button type="button" class="alert-close" onclick="this.parentElement.remove()">
                <i class='bx bx-x'></i>
            </button>
        `;

        alertsContainer.appendChild(alert);

        // Auto-remove after 5 seconds
        setTimeout(() => {
            if (alert.parentElement) {
                alert.remove();
            }
        }, 5000);
    }

    function createAlertsContainer() {
        const container = document.createElement('div');
        container.className = 'messages-container';
        const pageContainer = document.querySelector('.page-container');
        const contentCard = document.querySelector('.content-card');
        pageContainer.insertBefore(container, contentCard);
        return container;
    }
});
</script>

{% endblock %}