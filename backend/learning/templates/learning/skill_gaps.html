{% extends 'dashboard/base.html' %}
{% load static %}

{% block title %}Skill Gap Analysis{% endblock %}

{% block content %}
<!-- Breadcrumb -->
<nav style="margin-bottom:.75rem;font-size:.85rem;color:var(--text-muted)">
    <a href="{% url 'dashboard:home' %}" style="color:var(--primary-color);text-decoration:none">Home</a>
    <span style="margin:0 .35rem">›</span>
    <a href="{% url 'learning:learning_dashboard' %}" style="color:var(--primary-color);text-decoration:none">Learning</a>
    <span style="margin:0 .35rem">›</span>
    <span>Skill Gap Analysis</span>
</nav>

<div class="sg-page">

    <!-- ───── Header ───── -->
    <div class="sg-header">
        <div>
            <h1 class="sg-title"><i class='bx bx-line-chart'></i> Skill Gap Analysis</h1>
            <p class="sg-subtitle">Identify areas for improvement and plan your learning journey</p>
        </div>
        <div class="sg-header-actions">
            <button class="sg-btn sg-btn-outline" onclick="sgToggleSection('compare')">
                <i class='bx bx-search-alt'></i> Compare with Job
            </button>
            <a href="{% url 'learning:course_catalog' %}" class="sg-btn sg-btn-primary">
                <i class='bx bx-book-open'></i> Browse Courses
            </a>
        </div>
    </div>

    <!-- ───── KPI Cards ───── -->
    <div class="sg-kpi-row">
        <div class="sg-kpi">
            <div class="sg-kpi-icon" style="background:var(--danger-light);color:var(--danger-color)">
                <i class='bx bx-target-lock'></i>
            </div>
            <div class="sg-kpi-body">
                <span class="sg-kpi-val">{{ open_gaps_count }}</span>
                <span class="sg-kpi-label">Open Gaps</span>
            </div>
        </div>
        <div class="sg-kpi">
            <div class="sg-kpi-icon" style="background:var(--success-light);color:var(--success-color)">
                <i class='bx bx-check-shield'></i>
            </div>
            <div class="sg-kpi-body">
                <span class="sg-kpi-val">{{ total_skills }}</span>
                <span class="sg-kpi-label">Your Skills</span>
            </div>
        </div>
        <div class="sg-kpi">
            <div class="sg-kpi-icon" style="background:var(--warning-light);color:var(--warning-color)">
                <i class='bx bx-time-five'></i>
            </div>
            <div class="sg-kpi-body">
                <span class="sg-kpi-val">{{ total_hours_needed }}h</span>
                <span class="sg-kpi-label">Learning Needed</span>
            </div>
        </div>
        <div class="sg-kpi">
            <div class="sg-kpi-icon" style="background:var(--primary-light);color:var(--primary-color)">
                <i class='bx bx-shield-quarter'></i>
            </div>
            <div class="sg-kpi-body">
                <span class="sg-kpi-val">{{ readiness_pct }}%</span>
                <span class="sg-kpi-label">Readiness Score</span>
            </div>
        </div>
    </div>

    <!-- ───── Job Comparison (collapsible) ───── -->
    <div id="sg-compare" class="sg-card sg-compare-card" style="display:none">
        <div class="sg-card-head">
            <h3><i class='bx bx-search'></i> Compare with Job Requirements</h3>
            <button class="sg-close-btn" onclick="sgToggleSection('compare')" title="Close">
                <i class='bx bx-x'></i>
            </button>
        </div>
        <p class="sg-muted" style="margin-bottom:1rem">Select a job to identify skills you need to develop</p>
        <form id="sg-compare-form" class="sg-compare-form">
            {% csrf_token %}
            <div class="sg-search-wrap">
                <i class='bx bx-briefcase'></i>
                <select name="job_id" id="sg-job-select" required>
                    <option value="">Select a job…</option>
                    {% for job in available_jobs %}
                    <option value="{{ job.id }}">{{ job.title }} — {{ job.company }}</option>
                    {% endfor %}
                </select>
            </div>
            <button type="submit" class="sg-btn sg-btn-primary">
                <i class='bx bx-analyse'></i> Analyze
            </button>
        </form>
        <div id="sg-compare-result" class="sg-compare-result" style="display:none"></div>
    </div>

    <!-- ───── Charts Row ───── -->
    <div class="sg-charts-row">
        <!-- Radar: Current vs Required -->
        <div class="sg-card sg-card-chart">
            <h3 class="sg-card-title">Skill Radar</h3>
            <p class="sg-muted">Your current level vs. required level</p>
            <div class="sg-chart-wrap">
                <canvas id="sgRadarChart"></canvas>
            </div>
            {% if not skill_gaps %}
            <div class="sg-chart-empty">
                <i class='bx bx-info-circle'></i>
                <span>No gaps to display. Use "Compare with Job" above.</span>
            </div>
            {% endif %}
        </div>

        <!-- Priority Breakdown -->
        <div class="sg-card sg-card-chart">
            <h3 class="sg-card-title">Priority Breakdown</h3>
            <p class="sg-muted">Gap distribution by urgency</p>
            <div class="sg-chart-wrap">
                <div class="sg-chart-wrap-doughnut">
                    <canvas id="sgPriorityChart"></canvas>
                </div>
            </div>
            <div class="sg-legend">
                <span class="sg-legend-item"><span class="sg-dot" style="background:#ef4444"></span>Critical</span>
                <span class="sg-legend-item"><span class="sg-dot" style="background:#f59e0b"></span>High</span>
                <span class="sg-legend-item"><span class="sg-dot" style="background:#3b82f6"></span>Moderate</span>
                <span class="sg-legend-item"><span class="sg-dot" style="background:#10b981"></span>Low</span>
            </div>
        </div>
    </div>

    <!-- ───── Your Skills Snapshot ───── -->
    <div class="sg-card">
        <div class="sg-card-head">
            <h3 class="sg-card-title"><i class='bx bx-trophy'></i> Your Verified Skills</h3>
            <span class="sg-badge sg-badge-info">{{ verified_skills.count }} verified</span>
        </div>
        <div class="sg-skills-grid">
            {% for sk in verified_skills %}
            <div class="sg-skill-chip">
                <span class="sg-skill-name">{{ sk.skill.name }}</span>
                <span class="sg-skill-lvl {% if sk.verified_level >= 7 %}sg-lvl-high{% elif sk.verified_level >= 5 %}sg-lvl-mid{% else %}sg-lvl-low{% endif %}">
                    {{ sk.verified_level|floatformat:1 }}
                </span>
                <div class="sg-skill-bar-mini">
                    <div style="width:{{ sk.verified_level|floatformat:0 }}0%"></div>
                </div>
            </div>
            {% empty %}
            <div class="sg-empty-inline">
                <i class='bx bx-info-circle'></i>
                No verified skills yet.
                <a href="{% url 'assessments:skill_intake_dashboard' %}">Take assessments →</a>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- ───── Gap List ───── -->
    <div class="sg-card">
        <div class="sg-card-head">
            <h3 class="sg-card-title"><i class='bx bx-target-lock'></i> Skill Gaps ({{ open_gaps_count }})</h3>
            <div class="sg-filter-pills">
                <a href="{% url 'learning:skill_gaps' %}" class="sg-pill {% if not priority_filter %}sg-pill-active{% endif %}">All</a>
                <a href="?priority=critical" class="sg-pill {% if priority_filter == 'critical' %}sg-pill-active{% endif %}" style="--pill-c:var(--danger-color)">Critical ({{ priority_counts.critical }})</a>
                <a href="?priority=high" class="sg-pill {% if priority_filter == 'high' %}sg-pill-active{% endif %}" style="--pill-c:var(--warning-color)">High ({{ priority_counts.high }})</a>
                <a href="?priority=moderate" class="sg-pill {% if priority_filter == 'moderate' %}sg-pill-active{% endif %}" style="--pill-c:var(--primary-color)">Moderate ({{ priority_counts.moderate }})</a>
                <a href="?priority=low" class="sg-pill {% if priority_filter == 'low' %}sg-pill-active{% endif %}" style="--pill-c:var(--success-color)">Low ({{ priority_counts.low }})</a>
            </div>
        </div>

        <div class="sg-gap-list">
            {% for gap in skill_gaps %}
            <div class="sg-gap-card sg-priority-{{ gap.priority }}">
                <div class="sg-gap-top">
                    <div>
                        <h4 class="sg-gap-name">{{ gap.skill.name }}</h4>
                        {% if gap.skill.category %}
                        <span class="sg-gap-cat">{{ gap.skill.category.name }}</span>
                        {% endif %}
                    </div>
                    <span class="sg-priority-tag sg-priority-tag-{{ gap.priority }}">{{ gap.get_priority_display }}</span>
                </div>

                <!-- Level bar -->
                <div class="sg-level-visual">
                    <div class="sg-level-labels">
                        <span>Current: <strong>{{ gap.current_level|floatformat:1 }}</strong></span>
                        <span>Required: <strong>{{ gap.required_level|floatformat:1 }}</strong></span>
                    </div>
                    <div class="sg-level-track">
                        <div class="sg-level-fill" style="width:{% widthratio gap.current_level 10 100 %}%"></div>
                        <div class="sg-level-target" style="left:{% widthratio gap.required_level 10 100 %}%"></div>
                    </div>
                    <div class="sg-level-meta">
                        <span class="sg-gap-val">Gap: {{ gap.gap_value|floatformat:1 }} pts</span>
                        <span class="sg-gap-hrs"><i class='bx bx-time-five'></i> ~{{ gap.estimated_learning_hours }}h</span>
                    </div>
                </div>

                {% if gap.target_job_title or gap.related_job %}
                <div class="sg-gap-context">
                    <i class='bx bx-briefcase'></i>
                    Required for: <strong>{% if gap.target_job_title %}{{ gap.target_job_title }}{% elif gap.related_job %}{{ gap.related_job.title }}{% endif %}</strong>
                </div>
                {% endif %}

                <!-- Recommended courses -->
                {% if gap.courses %}
                <div class="sg-gap-courses">
                    <span class="sg-course-label"><i class='bx bx-book-reader'></i> Recommended Courses</span>
                    <div class="sg-course-chips">
                        {% for course in gap.courses %}
                        <a href="{{ course.url }}" target="_blank" class="sg-course-chip" title="{{ course.title }}">
                            <span class="sg-course-platform">{{ course.get_platform_display }}</span>
                            {{ course.title|truncatechars:40 }}
                            {% if course.rating > 0 %}
                            <span class="sg-course-rating">★ {{ course.rating|floatformat:1 }}</span>
                            {% endif %}
                        </a>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>
            {% empty %}
            <div class="sg-empty-state">
                <div class="sg-empty-icon"><i class='bx bx-check-circle'></i></div>
                <h4>No Skill Gaps Found</h4>
                <p>Use the <strong>"Compare with Job"</strong> tool above to analyze your skill gaps for a target role.</p>
                <button class="sg-btn sg-btn-primary" onclick="sgToggleSection('compare')">
                    <i class='bx bx-search-alt'></i> Compare Now
                </button>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- ───── Addressed Gaps ───── -->
    {% if addressed_count > 0 %}
    <div class="sg-card sg-card-muted">
        <div class="sg-card-head">
            <h3 class="sg-card-title"><i class='bx bx-check-double'></i> Addressed Gaps</h3>
            <span class="sg-badge sg-badge-success">{{ addressed_count }}</span>
        </div>
        <p class="sg-muted">Skills where you've closed the gap — great work!</p>
    </div>
    {% endif %}

    <!-- ───── Quick Actions ───── -->
    <div class="sg-actions-row">
        <a href="{% url 'assessments:skill_intake_dashboard' %}" class="sg-action-card">
            <div class="sg-action-icon" style="background:var(--primary-light);color:var(--primary-color)"><i class='bx bx-edit'></i></div>
            <div>
                <strong>Take Assessments</strong>
                <p>Verify your skill levels to get accurate gap data</p>
            </div>
        </a>
        <a href="{% url 'learning:course_catalog' %}" class="sg-action-card">
            <div class="sg-action-icon" style="background:var(--success-light);color:var(--success-color)"><i class='bx bx-book-open'></i></div>
            <div>
                <strong>Browse Courses</strong>
                <p>Find courses to close your skill gaps faster</p>
            </div>
        </a>
        <a href="{% url 'learning:learning_dashboard' %}" class="sg-action-card">
            <div class="sg-action-icon" style="background:var(--warning-light);color:var(--warning-color)"><i class='bx bx-road'></i></div>
            <div>
                <strong>Learning Paths</strong>
                <p>View your personalized learning roadmaps</p>
            </div>
        </a>
    </div>
</div>

<!-- ═══════ Chart.js ═══════ -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4/dist/chart.umd.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function(){
    const txtColor = getComputedStyle(document.documentElement).getPropertyValue('--text-color').trim() || '#333';
    const gridColor = getComputedStyle(document.documentElement).getPropertyValue('--border-color').trim() || '#e5e7eb';

    /* ── Radar Chart ── */
    const labels = {{ radar_labels|safe }};
    const current = {{ radar_current|safe }};
    const required = {{ radar_required|safe }};
    if(labels.length){
        new Chart(document.getElementById('sgRadarChart'),{
            type:'radar',
            data:{
                labels:labels,
                datasets:[
                    {label:'Current Level', data:current, borderColor:'#6366f1', backgroundColor:'rgba(99,102,241,.18)', pointBackgroundColor:'#6366f1', pointRadius:4},
                    {label:'Required Level', data:required, borderColor:'#ef4444', backgroundColor:'rgba(239,68,68,.10)', pointBackgroundColor:'#ef4444', borderDash:[5,5], pointRadius:4}
                ]
            },
            options:{
                responsive:true, maintainAspectRatio:false,
                scales:{r:{beginAtZero:true, max:10, ticks:{stepSize:2, color:txtColor, backdropColor:'transparent'}, grid:{color:gridColor}, pointLabels:{color:txtColor, font:{size:12}}}},
                plugins:{legend:{position:'bottom', labels:{color:txtColor, usePointStyle:true, padding:12}}}
            }
        });
    }

    /* ── Priority Doughnut ── */
    const pc = {{ priority_counts|safe }};
    const pData = [pc.critical||0, pc.high||0, pc.moderate||0, pc.low||0];
    if(pData.some(v=>v>0)){
        new Chart(document.getElementById('sgPriorityChart'),{
            type:'doughnut',
            data:{
                labels:['Critical','High','Moderate','Low'],
                datasets:[{data:pData, backgroundColor:['#ef4444','#f59e0b','#3b82f6','#10b981'], borderWidth:2, borderColor:'var(--card-bg)', hoverOffset:6}]
            },
            options:{
                responsive:true, maintainAspectRatio:false, cutout:'60%',
                plugins:{
                    legend:{display:false},
                    tooltip:{callbacks:{label:ctx=>ctx.label+': '+ctx.parsed+' gaps'}}
                }
            }
        });
    } else {
        document.getElementById('sgPriorityChart').parentElement.innerHTML='<div class="sg-chart-empty"><i class="bx bx-info-circle"></i><span>No gaps to chart yet</span></div>';
    }
});

/* ── Toggle compare section ── */
function sgToggleSection(id){
    const el = document.getElementById('sg-'+id);
    el.style.display = el.style.display==='none'?'block':'none';
    if(el.style.display==='block') el.scrollIntoView({behavior:'smooth', block:'center'});
}

/* ── AJAX job comparison ── */
document.getElementById('sg-compare-form').addEventListener('submit', function(e){
    e.preventDefault();
    const btn = this.querySelector('button[type=submit]');
    const orig = btn.innerHTML;
    btn.innerHTML='<i class="bx bx-loader-alt bx-spin"></i> Analyzing…';
    btn.disabled=true;
    const fd = new FormData(this);
    fetch("{% url 'learning:analyze_job_gaps' %}", {
        method:'POST',
        headers:{'X-CSRFToken':'{{ csrf_token }}','X-Requested-With':'XMLHttpRequest','Content-Type':'application/json'},
        body: JSON.stringify({job_id: fd.get('job_id')}),
        credentials:'same-origin'
    })
    .then(r=>r.json())
    .then(data=>{
        const box = document.getElementById('sg-compare-result');
        if(data.success){
            box.innerHTML='<div class="sg-result-ok"><i class="bx bx-check-circle"></i> '+data.message+'</div>';
            box.style.display='block';
            setTimeout(()=>location.reload(), 1200);
        } else {
            box.innerHTML='<div class="sg-result-err"><i class="bx bx-error"></i> ' + (data.error||'Unknown error') + '</div>';
            box.style.display='block';
        }
    })
    .catch(()=>{
        document.getElementById('sg-compare-result').innerHTML='<div class="sg-result-err"><i class="bx bx-error"></i> Network error</div>';
        document.getElementById('sg-compare-result').style.display='block';
    })
    .finally(()=>{btn.innerHTML=orig; btn.disabled=false;});
});
</script>

<!-- ═══════ Styles ═══════ -->
<style>
/* ── Page ── */
.sg-page{display:flex;flex-direction:column;gap:1.5rem}
.sg-header{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem}
.sg-title{font-size:1.55rem;font-weight:700;display:flex;align-items:center;gap:.5rem;color:var(--text-color);margin:0}
.sg-subtitle{color:var(--text-muted);margin-top:.25rem;font-size:.92rem}
.sg-header-actions{display:flex;gap:.6rem;flex-wrap:wrap;align-items:center}
.sg-muted{color:var(--text-muted);font-size:.85rem}

/* ── Buttons ── */
.sg-btn{display:inline-flex;align-items:center;gap:.4rem;padding:.55rem 1.1rem;border-radius:var(--radius);font-weight:600;font-size:.85rem;cursor:pointer;border:none;transition:all .2s}
.sg-btn-primary{background:var(--primary-color);color:#fff}
.sg-btn-primary:hover{opacity:.88}
.sg-btn-outline{background:transparent;border:1.5px solid var(--border-color);color:var(--text-color)}
.sg-btn-outline:hover{border-color:var(--primary-color);color:var(--primary-color)}

/* ── KPI Cards ── */
.sg-kpi-row{display:grid;grid-template-columns:repeat(4,1fr);gap:1rem}
.sg-kpi{display:flex;align-items:center;gap:.85rem;background:var(--card-bg);border:1px solid var(--border-color);border-radius:var(--radius-lg);padding:1rem 1.15rem}
.sg-kpi-icon{width:44px;height:44px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:1.3rem;flex-shrink:0}
.sg-kpi-val{font-size:1.35rem;font-weight:700;color:var(--text-color);display:block;line-height:1.1}
.sg-kpi-label{font-size:.76rem;color:var(--text-muted)}

/* ── Card ── */
.sg-card{background:var(--card-bg);border:1px solid var(--border-color);border-radius:var(--radius-lg);padding:1.5rem 1.6rem}
.sg-card-muted{opacity:.72}
.sg-card-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.2rem;flex-wrap:wrap;gap:.5rem}
.sg-card-title{font-size:1.08rem;font-weight:700;display:flex;align-items:center;gap:.4rem;color:var(--text-color)}
.sg-badge{padding:.2rem .6rem;border-radius:var(--radius);font-size:.72rem;font-weight:700}
.sg-badge-info{background:var(--primary-light);color:var(--primary-color)}
.sg-badge-success{background:var(--success-light);color:var(--success-color)}

/* ── Compare Card ── */
.sg-compare-card{border:1.5px dashed var(--primary-color);background:var(--card-bg)}
.sg-compare-form{display:flex;gap:.75rem;align-items:stretch}
.sg-search-wrap{flex:1;display:flex;align-items:center;gap:.5rem;border:1px solid var(--border-color);border-radius:var(--radius);padding:0 .8rem;background:var(--gray-50)}
.sg-search-wrap i{color:var(--text-muted);font-size:1.15rem}
.sg-search-wrap select{flex:1;border:none;background:transparent;padding:.65rem 0;font-size:.88rem;color:var(--text-color);outline:none}
.sg-close-btn{background:none;border:none;font-size:1.3rem;color:var(--text-muted);cursor:pointer}
.sg-compare-result{margin-top:1rem}
.sg-result-ok{display:flex;align-items:center;gap:.4rem;padding:.7rem 1rem;border-radius:var(--radius);background:var(--success-light);color:var(--success-color);font-weight:600}
.sg-result-err{display:flex;align-items:center;gap:.4rem;padding:.7rem 1rem;border-radius:var(--radius);background:var(--danger-light);color:var(--danger-color);font-weight:600}

/* ── Charts Row ── */
.sg-charts-row{display:grid;grid-template-columns:1fr 1fr;gap:1.25rem;align-items:start}
.sg-card-chart{display:flex;flex-direction:column;padding:1.5rem}
.sg-card-chart .sg-card-title{flex-shrink:0;margin:0 0 .2rem}
.sg-card-chart .sg-muted{flex-shrink:0;margin:0 0 1rem}
.sg-chart-wrap{position:relative;width:100%;height:220px;display:flex;align-items:center;justify-content:center}
.sg-chart-wrap canvas{width:100%!important;height:100%!important}
.sg-chart-wrap-doughnut{width:190px;height:190px;margin:0 auto}
.sg-chart-wrap-doughnut canvas{width:100%!important;height:100%!important}
.sg-chart-empty{display:flex;align-items:center;justify-content:center;gap:.4rem;padding:2rem;color:var(--text-muted);font-size:.88rem}
.sg-legend{display:flex;gap:1rem;justify-content:center;margin-top:.75rem;flex-wrap:wrap;flex-shrink:0}
.sg-legend-item{display:flex;align-items:center;gap:.3rem;font-size:.78rem;color:var(--text-muted)}
.sg-dot{width:10px;height:10px;border-radius:50%;display:inline-block}

/* ── Skills Grid ── */
.sg-skills-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:.85rem}
.sg-skill-chip{background:var(--gray-50);border:1px solid var(--border-color);border-radius:var(--radius);padding:.75rem 1rem;display:flex;flex-wrap:wrap;align-items:center;gap:.5rem;min-width:0}
.sg-skill-name{font-weight:600;font-size:.9rem;flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;min-width:0}
.sg-skill-lvl{padding:.15rem .55rem;border-radius:var(--radius);font-weight:700;font-size:.78rem;flex-shrink:0}
.sg-lvl-high{background:var(--success-light);color:var(--success-color)}
.sg-lvl-mid{background:var(--warning-light);color:var(--warning-color)}
.sg-lvl-low{background:var(--danger-light);color:var(--danger-color)}
.sg-skill-bar-mini{width:100%;height:4px;background:var(--gray-200);border-radius:2px;overflow:hidden}
.sg-skill-bar-mini>div{height:100%;background:linear-gradient(90deg,var(--primary-color),var(--success-color));border-radius:2px}
.sg-empty-inline{grid-column:1/-1;padding:1rem;color:var(--text-muted);display:flex;align-items:center;gap:.5rem;font-size:.88rem}
.sg-empty-inline a{color:var(--primary-color);font-weight:600;text-decoration:none}

/* ── Filter Pills ── */
.sg-filter-pills{display:flex;gap:.4rem;flex-wrap:wrap}
.sg-pill{padding:.3rem .8rem;border-radius:20px;font-size:.78rem;font-weight:600;text-decoration:none;color:var(--text-muted);background:var(--gray-100);border:1px solid transparent;transition:all .15s}
.sg-pill:hover{border-color:var(--pill-c,var(--primary-color));color:var(--pill-c,var(--primary-color))}
.sg-pill-active{background:var(--primary-color);color:#fff!important;border-color:var(--primary-color)}

/* ── Gap Cards ── */
.sg-gap-list{display:flex;flex-direction:column;gap:1rem}
.sg-gap-card{background:var(--gray-50);border:1px solid var(--border-color);border-left:4px solid;border-radius:var(--radius-lg);padding:1.3rem 1.4rem;transition:box-shadow .2s}
.sg-gap-card:hover{box-shadow:var(--shadow-lg)}
.sg-priority-critical{border-left-color:#ef4444}
.sg-priority-high{border-left-color:#f59e0b}
.sg-priority-moderate{border-left-color:#3b82f6}
.sg-priority-low{border-left-color:#10b981}
.sg-gap-top{display:flex;justify-content:space-between;align-items:flex-start;gap:.5rem;margin-bottom:.65rem}
.sg-gap-name{font-weight:700;font-size:1rem;color:var(--text-color)}
.sg-gap-cat{font-size:.78rem;color:var(--text-muted)}
.sg-priority-tag{padding:.2rem .65rem;border-radius:20px;font-size:.72rem;font-weight:700;text-transform:uppercase;letter-spacing:.3px}
.sg-priority-tag-critical{background:var(--danger-light);color:#ef4444}
.sg-priority-tag-high{background:var(--warning-light);color:#d97706}
.sg-priority-tag-moderate{background:var(--primary-light);color:var(--primary-color)}
.sg-priority-tag-low{background:var(--success-light);color:#059669}

/* ── Level Visual ── */
.sg-level-visual{margin-bottom:.6rem}
.sg-level-labels{display:flex;justify-content:space-between;font-size:.78rem;color:var(--text-muted);margin-bottom:.35rem}
.sg-level-labels strong{color:var(--text-color)}
.sg-level-track{position:relative;height:10px;background:var(--gray-200);border-radius:6px;overflow:visible}
.sg-level-fill{position:absolute;top:0;left:0;height:100%;border-radius:6px;background:linear-gradient(90deg,#6366f1,#818cf8);transition:width .4s}
.sg-level-target{position:absolute;top:-3px;height:16px;width:3px;background:#ef4444;border-radius:2px;z-index:1}
.sg-level-meta{display:flex;justify-content:space-between;margin-top:.4rem;font-size:.78rem;color:var(--text-muted)}
.sg-gap-val{font-weight:600;color:var(--danger-color)}
.sg-gap-hrs{display:flex;align-items:center;gap:.2rem}

/* ── Gap Context ── */
.sg-gap-context{display:flex;align-items:center;gap:.35rem;font-size:.82rem;color:var(--text-muted);margin-bottom:.5rem}
.sg-gap-context i{color:var(--primary-color)}

/* ── Courses ── */
.sg-gap-courses{margin-top:.6rem;padding-top:.6rem;border-top:1px dashed var(--border-color)}
.sg-course-label{font-size:.78rem;font-weight:600;color:var(--text-muted);display:flex;align-items:center;gap:.3rem;margin-bottom:.5rem}
.sg-course-chips{display:flex;gap:.5rem;flex-wrap:wrap}
.sg-course-chip{display:inline-flex;align-items:center;gap:.4rem;padding:.35rem .7rem;background:var(--card-bg);border:1px solid var(--border-color);border-radius:var(--radius);font-size:.78rem;color:var(--text-color);text-decoration:none;transition:all .15s}
.sg-course-chip:hover{border-color:var(--primary-color);color:var(--primary-color)}
.sg-course-platform{background:var(--primary-light);color:var(--primary-color);padding:.1rem .4rem;border-radius:4px;font-size:.68rem;font-weight:700}
.sg-course-rating{color:#f59e0b;font-weight:600;font-size:.72rem}

/* ── Empty State ── */
.sg-empty-state{text-align:center;padding:3rem 1rem}
.sg-empty-icon{font-size:3rem;color:var(--success-color);margin-bottom:.5rem}
.sg-empty-state h4{margin:.5rem 0;color:var(--text-color)}
.sg-empty-state p{color:var(--text-muted);font-size:.9rem;margin-bottom:1.2rem}

/* ── Action Cards ── */
.sg-actions-row{display:grid;grid-template-columns:repeat(3,1fr);gap:1rem}
.sg-action-card{display:flex;align-items:center;gap:1rem;padding:1.1rem 1.2rem;background:var(--card-bg);border:1px solid var(--border-color);border-radius:var(--radius-lg);text-decoration:none;color:var(--text-color);transition:all .2s}
.sg-action-card:hover{border-color:var(--primary-color);box-shadow:var(--shadow-lg)}
.sg-action-icon{width:42px;height:42px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:1.25rem;flex-shrink:0}
.sg-action-card strong{font-size:.9rem;display:block;margin-bottom:.15rem}
.sg-action-card p{font-size:.78rem;color:var(--text-muted);margin:0}

/* ── Responsive ── */
@media(max-width:1100px){
    .sg-kpi-row{grid-template-columns:repeat(2,1fr)}
}
@media(max-width:900px){
    .sg-charts-row{grid-template-columns:1fr}
    .sg-chart-wrap{height:250px}
    .sg-chart-wrap-doughnut{width:210px;height:210px}
    .sg-actions-row{grid-template-columns:1fr}
}
@media(max-width:600px){
    .sg-kpi-row{grid-template-columns:1fr}
    .sg-header{flex-direction:column;align-items:flex-start}
    .sg-compare-form{flex-direction:column}
    .sg-filter-pills{overflow-x:auto;flex-wrap:nowrap}
    .sg-skills-grid{grid-template-columns:1fr}
}
</style>
{% endblock %}
