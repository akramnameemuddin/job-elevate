{% extends 'dashboard/base.html' %}
{% load static %}

{% block title %}Job Fit Scores - JobElevate{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="row mb-4">
        <div class="col-12">
            <h1><i class="fas fa-bullseye text-primary"></i> Job Fit Scores</h1>
            <p class="lead">Discover which jobs match your verified skills best.</p>
        </div>
    </div>

    <!-- Summary Stats -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card bg-success text-white">
                <div class="card-body text-center">
                    <h3>{{ excellent_matches|length }}</h3>
                    <p class="mb-0">Excellent Matches (85%+)</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card bg-primary text-white">
                <div class="card-body text-center">
                    <h3>{{ good_matches|length }}</h3>
                    <p class="mb-0">Good Matches (70-84%)</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card bg-warning text-white">
                <div class="card-body text-center">
                    <h3>{{ fair_matches|length }}</h3>
                    <p class="mb-0">Fair Matches (50-69%)</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Job Matches -->
    {% if fit_scores %}
        {% for fs in fit_scores %}
            <div class="card mb-3">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-8">
                            <h4>
                                <a href="{% url 'jobs:job_detail' fs.job.id %}">{{ fs.job.title }}</a>
                            </h4>
                            <p class="text-muted mb-2">
                                {{ fs.job.company }} â€¢ {{ fs.job.location }} â€¢ {{ fs.job.job_type }}
                            </p>
                            <p class="mb-2">{{ fs.fit_score.recommendation }}</p>
                            <div class="mb-2">
                                <span class="badge badge-success">ðŸŸ¢ {{ fs.fit_score.strengths_count }} Strengths</span>
                                {% if fs.fit_score.minor_gaps_count > 0 %}
                                    <span class="badge badge-warning">ðŸŸ¡ {{ fs.fit_score.minor_gaps_count }} Minor Gaps</span>
                                {% endif %}
                                {% if fs.fit_score.critical_gaps_count > 0 %}
                                    <span class="badge badge-danger">ðŸ”´ {{ fs.fit_score.critical_gaps_count }} Critical Gaps</span>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-4 text-center">
                            <div class="display-3 
                                {% if fs.fit_score.overall_score >= 85 %}text-success
                                {% elif fs.fit_score.overall_score >= 70 %}text-primary
                                {% elif fs.fit_score.overall_score >= 50 %}text-warning
                                {% else %}text-danger{% endif %}">
                                {{ fs.fit_score.overall_score|floatformat:0 }}%
                            </div>
                            <p class="text-muted mb-3">Match Score</p>
                            <div class="btn-group-vertical" role="group">
                                <a href="{% url 'assessments:job_fit_detail' fs.job.id %}" class="btn btn-sm btn-outline-primary">
                                    <i class="fas fa-chart-bar"></i> Details
                                </a>
                                <a href="{% url 'assessments:job_skill_gap_analysis' fs.job.id %}" class="btn btn-sm btn-outline-info">
                                    <i class="fas fa-tasks"></i> Gap Analysis
                                </a>
                                {% if fs.fit_score.is_good_match %}
                                    <a href="{% url 'jobs:apply_for_job' fs.job.id %}" class="btn btn-sm btn-success">
                                        <i class="fas fa-paper-plane"></i> Apply Now
                                    </a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Progress Bars -->
                    <div class="mt-3">
                        <div class="row">
                            <div class="col-md-6">
                                <small class="text-muted">Skill Match</small>
                                <div class="progress" style="height: 20px;">
                                    <div class="progress-bar bg-primary" style="width: {{ fs.fit_score.skill_match_score|floatformat:0 }}%">
                                        {{ fs.fit_score.skill_match_score|floatformat:0 }}%
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <small class="text-muted">Experience Match</small>
                                <div class="progress" style="height: 20px;">
                                    <div class="progress-bar bg-info" style="width: {{ fs.fit_score.experience_score|floatformat:0 }}%">
                                        {{ fs.fit_score.experience_score|floatformat:0 }}%
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% endfor %}
    {% else %}
        <div class="alert alert-info">
            <h5><i class="fas fa-info-circle"></i> No Job Matches Yet</h5>
            <p>Complete skill assessments to get personalized job matches!</p>
            <a href="{% url 'assessments:skill_intake_dashboard' %}" class="btn btn-primary">
                <i class="fas fa-brain"></i> Manage Skills
            </a>
        </div>
    {% endif %}
</div>
{% endblock %}
