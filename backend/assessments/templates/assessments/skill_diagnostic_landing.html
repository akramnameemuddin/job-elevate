{% extends 'dashboard/base.html' %}
{% load static %}


{% block title %}Skill Diagnostic | JobElevate{% endblock %}

{% block content %}
<!-- Breadcrumb Navigation -->
<div class="breadcrumb">
    <div class="breadcrumb-item">
        <a href="{% url 'dashboard:home' %}" class="breadcrumb-link">Home</a>
        <i class='bx bx-chevron-right'></i>
    </div>
    <div class="breadcrumb-item">
        <span>Skill Diagnostic</span>
    </div>
</div>

<!-- Page Header -->
<div class="page-content-header">
    <h1 class="page-title">
        <i class='bx bx-brain'></i> Skill Diagnostic Dashboard
    </h1>
    <p class="page-subtitle">Assess your skills, discover gaps, and boost your job readiness</p>
</div>

<!-- Messages -->
{% if messages %}
<div class="notification-container">
    {% for message in messages %}
    <div class="notification {{ message.tags }}">
        <i class='bx
            {% if message.tags == "success" %}bx-check-circle
            {% elif message.tags == "error" %}bx-error
            {% elif message.tags == "warning" %}bx-error-circle
            {% else %}bx-info-circle{% endif %}'>
        </i>
        <span>{{ message }}</span>
        <button class="notification-close"><i class='bx bx-x'></i></button>
    </div>
    {% endfor %}
</div>
{% endif %}

<!-- Overall Statistics -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-icon blue">
            <i class='bx bx-check-double'></i>
        </div>
        <div class="stat-content">
            <h3>{{ verified_count }}</h3>
            <p>Verified Skills</p>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="stat-icon green">
            <i class='bx bx-trending-up'></i>
        </div>
        <div class="stat-content">
            <h3>{{ completion_percentage }}%</h3>
            <p>Completion Rate</p>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="stat-icon purple">
            <i class='bx bx-star'></i>
        </div>
        <div class="stat-content">
            <h3>{{ avg_proficiency }}/10</h3>
            <p>Avg Proficiency</p>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="stat-icon orange">
            <i class='bx bx-briefcase'></i>
        </div>
        <div class="stat-content">
            <h3>{{ total_skills_available }}</h3>
            <p>Total Skills Available</p>
        </div>
    </div>
</div>

<!-- Main Content Grid -->
<div class="diagnostic-content-grid">
    <!-- Left Column: Verified Skills & Progress -->
    <div class="diagnostic-main-column">
        <!-- Verified Skills Section -->
        <div class="card">
            <div class="card-header">
                <h2><i class='bx bx-badge-check'></i> Your Verified Skills</h2>
                <a href="{% url 'assessments:skill_intake_dashboard' %}" class="btn btn-primary btn-sm">
                    <i class='bx bx-plus'></i> Add More Skills
                </a>
            </div>
            <div class="card-body">
                {% if verified_skills %}
                    <div class="skills-list">
                        {% for profile in verified_skills %}
                        <div class="skill-item verified">
                            <div class="skill-info">
                                <div class="skill-name">
                                    <i class='bx bx-check-circle'></i>
                                    <strong>{{ profile.skill.name }}</strong>
                                    <span class="skill-category">{{ profile.skill.category.name }}</span>
                                </div>
                                <div class="skill-level">
                                    <div class="proficiency-bar">
                                        <div class="proficiency-fill" style="width: {% widthratio profile.verified_level 10 100 %}%"></div>
                                    </div>
                                    <span class="proficiency-value">{{ profile.verified_level }}/10</span>
                                </div>
                            </div>
                            <div class="skill-actions">
                                <span class="skill-badge {{ profile.get_proficiency_display|lower }}">
                                    {{ profile.get_proficiency_display }}
                                </span>
                                <small class="text-muted">
                                    {% if profile.last_assessed_date %}
                                        Verified {{ profile.last_assessed_date|timesince }} ago
                                    {% endif %}
                                </small>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="empty-state">
                        <i class='bx bx-ghost'></i>
                        <h3>No Verified Skills Yet</h3>
                        <p>Start by taking assessments to verify your skills!</p>
                        <a href="{% url 'assessments:skill_intake_dashboard' %}" class="btn btn-primary">
                            Browse Skills
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Skill Categories Progress -->
        <div class="card">
            <div class="card-header">
                <h2><i class='bx bx-category'></i> Progress by Category</h2>
            </div>
            <div class="card-body">
                <div class="categories-progress">
                    {% for category in categories %}
                    <div class="category-progress-item">
                        <div class="category-header">
                            <span class="category-name">{{ category.name }}</span>
                            <span class="category-count">{{ category.user_verified }}/{{ category.total_skills }}</span>
                        </div>
                        <div class="progress-bar">
                            {% if category.total_skills > 0 %}
                                {% widthratio category.user_verified category.total_skills 100 as progress_pct %}
                                <div class="progress-fill" style="width: {{ progress_pct }}%"></div>
                            {% else %}
                                <div class="progress-fill" style="width: 0%"></div>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <!-- Right Column: Action Items -->
    <div class="diagnostic-sidebar-column">
        <!-- Skill Gaps (High Priority) -->
        <div class="card highlight-card">
            <div class="card-header">
                <h2><i class='bx bx-error-circle'></i> Top Skill Gaps</h2>
                <span class="badge badge-warning">High Demand</span>
            </div>
            <div class="card-body">
                {% if skill_gaps %}
                    <div class="skill-gaps-list">
                        {% for gap in skill_gaps %}
                        <div class="gap-item">
                            <div class="gap-info">
                                <strong>{{ gap.skill_name }}</strong>
                                <small class="text-muted">{{ gap.category }}</small>
                            </div>
                            <div class="gap-demand">
                                <span class="demand-badge">{{ gap.jobs_requiring }} jobs</span>
                                <span class="level-required">Avg: {{ gap.avg_level_required }}/10</span>
                            </div>
                            <a href="{% url 'assessments:skill_intake_dashboard' %}" class="btn btn-sm btn-outline-primary">
                                Learn & Assess
                            </a>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="empty-state-sm">
                        <i class='bx bx-check-circle'></i>
                        <p>Great! You're covering the top in-demand skills.</p>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Recent Assessment Activity -->
        <div class="card">
            <div class="card-header">
                <h2><i class='bx bx-time'></i> Recent Activity</h2>
            </div>
            <div class="card-body">
                {% if recent_attempts %}
                    <div class="activity-list">
                        {% for attempt in recent_attempts %}
                        <div class="activity-item">
                            <div class="activity-icon {% if attempt.passed %}success{% else %}warning{% endif %}">
                                <i class='bx {% if attempt.passed %}bx-check{% else %}bx-x{% endif %}'></i>
                            </div>
                            <div class="activity-details">
                                <strong>{{ attempt.assessment.skill.name }}</strong>
                                <small>{{ attempt.completed_at|timesince }} ago</small>
                            </div>
                            <div class="activity-score">
                                <span class="score-badge {% if attempt.passed %}success{% else %}warning{% endif %}">
                                    {{ attempt.percentage|floatformat:0 }}%
                                </span>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="empty-state-sm">
                        <i class='bx bx-history'></i>
                        <p>No recent assessments</p>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="card">
            <div class="card-header">
                <h2><i class='bx bx-bolt'></i> Quick Actions</h2>
            </div>
            <div class="card-body">
                <div class="quick-actions">
                    <a href="{% url 'assessments:skill_intake_dashboard' %}" class="action-btn">
                        <i class='bx bx-search'></i>
                        <span>Browse All Skills</span>
                    </a>
                    <a href="{% url 'assessments:skill_intake_dashboard' %}" class="action-btn">
                        <i class='bx bx-list-ul'></i>
                        <span>View All Assessments</span>
                    </a>
                    <a href="{% url 'jobs:job_listings' %}" class="action-btn">
                        <i class='bx bx-briefcase'></i>
                        <span>Find Jobs</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* Diagnostic Layout */
.diagnostic-content-grid {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 2rem;
    margin-top: 2rem;
}

.diagnostic-main-column {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.diagnostic-sidebar-column {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

/* Stats Grid */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.stat-card {
    background: #fff;
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    display: flex;
    align-items: center;
    gap: 1rem;
}

.stat-icon {
    width: 60px;
    height: 60px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.8rem;
}

.stat-icon.blue { background: #e3f2fd; color: #1976d2; }
.stat-icon.green { background: #e8f5e9; color: #388e3c; }
.stat-icon.purple { background: #f3e5f5; color: #7b1fa2; }
.stat-icon.orange { background: #fff3e0; color: #f57c00; }

.stat-content h3 {
    font-size: 2rem;
    font-weight: 700;
    margin: 0;
    color: #2c3e50;
}

.stat-content p {
    margin: 0;
    color: #7f8c8d;
    font-size: 0.9rem;
}

/* Card Styles */
.card {
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}

.card-header {
    padding: 1.5rem;
    border-bottom: 1px solid #ecf0f1;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.card-header h2 {
    font-size: 1.3rem;
    font-weight: 600;
    color: #2c3e50;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin: 0;
}

.card-body {
    padding: 1.5rem;
}

.highlight-card {
    border: 2px solid #3498db;
}

/* Skills List */
.skills-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.skill-item {
    padding: 1rem;
    background: #f8f9fa;
    border-radius: 8px;
    border-left: 4px solid #3498db;
}

.skill-item.verified {
    border-left-color: #27ae60;
}

.skill-info {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
}

.skill-name {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.skill-name i {
    color: #27ae60;
    font-size: 1.2rem;
}

.skill-name strong {
    color: #2c3e50;
}

.skill-category {
    background: #ecf0f1;
    padding: 0.2rem 0.6rem;
    border-radius: 12px;
    font-size: 0.75rem;
    color: #7f8c8d;
}

.skill-level {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.proficiency-bar {
    flex: 1;
    height: 8px;
    background: #ecf0f1;
    border-radius: 4px;
    overflow: hidden;
}

.proficiency-fill {
    height: 100%;
    background: linear-gradient(90deg, #3498db, #27ae60);
    border-radius: 4px;
    transition: width 0.3s ease;
}

.proficiency-value {
    font-weight: 600;
    color: #2c3e50;
    min-width: 45px;
}

.skill-actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.skill-badge {
    padding: 0.3rem 0.8rem;
    border-radius: 16px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
}

.skill-badge.expert {
    background: #8e44ad;
    color: #fff;
}

.skill-badge.advanced {
    background: #27ae60;
    color: #fff;
}

.skill-badge.intermediate {
    background: #3498db;
    color: #fff;
}

.skill-badge.basic {
    background: #f39c12;
    color: #fff;
}

.skill-badge.beginner {
    background: #95a5a6;
    color: #fff;
}

/* Category Progress */
.categories-progress {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.category-progress-item {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.category-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.category-name {
    font-weight: 600;
    color: #2c3e50;
}

.category-count {
    font-size: 0.9rem;
    color: #7f8c8d;
}

.progress-bar {
    height: 10px;
    background: #ecf0f1;
    border-radius: 5px;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #3498db, #9b59b6);
    border-radius: 5px;
    transition: width 0.3s ease;
}

/* Skill Gaps */
.skill-gaps-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.gap-item {
    padding: 1rem;
    background: #fff9e6;
    border-radius: 8px;
    border-left: 4px solid #f39c12;
}

.gap-info strong {
    color: #2c3e50;
    display: block;
}

.gap-demand {
    display: flex;
    gap: 0.5rem;
    margin: 0.5rem 0;
}

.demand-badge {
    background: #3498db;
    color: #fff;
    padding: 0.2rem 0.6rem;
    border-radius: 12px;
    font-size: 0.75rem;
}

.level-required {
    background: #e74c3c;
    color: #fff;
    padding: 0.2rem 0.6rem;
    border-radius: 12px;
    font-size: 0.75rem;
}

/* Activity List */
.activity-list {
    display: flex;
    flex-direction: column;
    gap: 0.8rem;
}

.activity-item {
    display: flex;
    align-items: center;
    gap: 0.8rem;
}

.activity-icon {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.activity-icon.success {
    background: #e8f5e9;
    color: #27ae60;
}

.activity-icon.warning {
    background: #fff3e0;
    color: #f39c12;
}

.activity-details {
    flex: 1;
    display: flex;
    flex-direction: column;
}

.activity-details strong {
    color: #2c3e50;
    font-size: 0.9rem;
}

.activity-details small {
    color: #7f8c8d;
    font-size: 0.75rem;
}

.score-badge {
    padding: 0.3rem 0.8rem;
    border-radius: 16px;
    font-size: 0.8rem;
    font-weight: 600;
}

.score-badge.success {
    background: #e8f5e9;
    color: #27ae60;
}

.score-badge.warning {
    background: #fff3e0;
    color: #f39c12;
}

/* Quick Actions */
.quick-actions {
    display: flex;
    flex-direction: column;
    gap: 0.8rem;
}

.action-btn {
    display: flex;
    align-items: center;
    gap: 0.8rem;
    padding: 1rem;
    background: #f8f9fa;
    border-radius: 8px;
    text-decoration: none;
    color: #2c3e50;
    transition: all 0.3s ease;
}

.action-btn:hover {
    background: #3498db;
    color: #fff;
    transform: translateX(5px);
}

.action-btn i {
    font-size: 1.5rem;
}

/* Empty States */
.empty-state {
    text-align: center;
    padding: 3rem 1rem;
}

.empty-state i {
    font-size: 4rem;
    color: #bdc3c7;
    margin-bottom: 1rem;
}

.empty-state h3 {
    color: #7f8c8d;
    margin-bottom: 0.5rem;
}

.empty-state p {
    color: #95a5a6;
    margin-bottom: 1.5rem;
}

.empty-state-sm {
    text-align: center;
    padding: 1.5rem;
}

.empty-state-sm i {
    font-size: 2rem;
    color: #bdc3c7;
    margin-bottom: 0.5rem;
}

.empty-state-sm p {
    color: #95a5a6;
    margin: 0;
}

/* Badge */
.badge {
    padding: 0.3rem 0.8rem;
    border-radius: 16px;
    font-size: 0.75rem;
    font-weight: 600;
}

.badge-warning {
    background: #fff3e0;
    color: #f57c00;
}

/* Responsive */
@media (max-width: 1024px) {
    .diagnostic-content-grid {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 768px) {
    .stats-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .skill-level {
        flex-direction: column;
        align-items: flex-start;
    }
}
</style>

<script>
// Close notifications
document.querySelectorAll('.notification-close').forEach(btn => {
    btn.addEventListener('click', function() {
        this.parentElement.remove();
    });
});

// Auto-close notifications after 5 seconds
setTimeout(() => {
    document.querySelectorAll('.notification').forEach(notification => {
        notification.style.transition = 'opacity 0.5s ease';
        notification.style.opacity = '0';
        setTimeout(() => notification.remove(), 500);
    });
}, 5000);
</script>

{% endblock %}
