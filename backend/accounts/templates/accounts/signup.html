{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sign Up - JobElevate</title>
    <!-- ==== "Inter" FONT-FAMILY FROM FONTS.GOOGLE.COM  ==== -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- ====  REMIXICON CDN ==== -->
    <link href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css" rel="stylesheet" />
    <style>
      /* ==== ROOT RESET ==== */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Inter", sans-serif;
      }
      *::before,
      *::after {
        box-sizing: border-box;
      }

      /* ==== CSS VARIABLES ==== */
      :root {
        --primary-color: #335eea;
        --secondary-color: #764ba2;
        --btn-hover-color: #2b50c7;
        --lg-heading: #161c2d;
        --text-content: #869ab8;
        --fixed-header-height: 4.5rem;
        --box-shadow: 0 10px 30px rgba(57, 108, 248, 0.1);
        --success-color: #10b981;
        --error-color: #ef4444;
        --warning-color: #f59e0b;
      }

      body {
        width: 100%;
        min-height: 100vh;
        overflow-x: hidden;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        position: relative;
      }

      body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse"><path d="M 20 0 L 0 0 0 20" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="1"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
        opacity: 0.3;
        z-index: -1;
      }

      a {
        text-decoration: none;
      }

      button {
        cursor: pointer;
      }

      /* ==== HEADER ==== */
      .header {
        height: var(--fixed-header-height);
        padding: 0 2rem;
        background-color: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        z-index: 100;
      }

      .nav {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: space-between;
        max-width: 1600px;
        margin: 0 auto;
      }

      .logo h2 {
        font-size: 28px;
        font-weight: 700;
        color: var(--primary-color);
      }

      .nav_menu_list {
        display: flex;
        align-items: center;
        list-style: none;
        gap: 2rem;
      }

      .nav_menu_item .nav_menu_link {
        font-size: 16px;
        font-weight: 500;
        color: var(--lg-heading);
        text-transform: capitalize;
        transition: color 0.3s ease;
      }

      .nav_menu_link:hover {
        color: var(--primary-color);
      }

      .toggle_btn {
        font-size: 20px;
        color: var(--lg-heading);
        background: transparent;
        border: none;
        display: none;
      }

      /* ==== MAIN CONTAINER ==== */
      .main-container {
        display: flex;
        min-height: 100vh;
        padding-top: var(--fixed-header-height);
      }

      /* ==== IMAGE SIDE ==== */
      .image-side {
        width: 45%;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
        backdrop-filter: blur(10px);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        padding: 2rem;
        position: relative;
        overflow: hidden;
      }
      .image-side::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="1"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
        opacity: 0.3;
      }
      .image-side img {
        max-width: 65%;
        height: auto;
        filter: drop-shadow(0 20px 40px rgba(0, 0, 0, 0.2));
        z-index: 1;
      }
      .image-side .welcome-text {
        margin-top: 2rem;
        text-align: center;
        z-index: 1;
      }
      .welcome-text h3 {
        font-size: 28px;
        color: white;
        margin-bottom: 1rem;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      }
      .welcome-text p {
        font-size: 16px;
        color: rgba(255, 255, 255, 0.9);
        max-width: 400px;
        line-height: 1.6;
        text-shadow: 0 1px 5px rgba(0, 0, 0, 0.2);
      }

      /* ==== FORM SIDE ==== */
      .form-side {
        width: 55%;
        display: flex;
        justify-content: center;
        align-items: flex-start;
        padding: 2rem;
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(10px);
        overflow-y: auto;
        max-height: calc(100vh - var(--fixed-header-height));
      }

      /* ==== FORM CONTAINER ==== */
      .form-container {
        width: 100%;
        max-width: 500px;
        padding: 3rem;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        position: relative;
        overflow: hidden;
        margin: 2rem 0;
      }

      .form-container::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
      }

      .form-container .title {
        font-size: 30px;
        font-weight: 700;
        color: var(--lg-heading);
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .form-container .subtitle {
        font-size: 16px;
        color: var(--text-content);
        margin-bottom: 2rem;
      }

      /* ==== FORM SECTIONS ==== */
      .signup-form, .otp-section {
        display: none;
        animation: fadeInSlide 0.5s ease-out;
      }

      .signup-form.active, .otp-section.active {
        display: block;
      }

      @keyframes fadeInSlide {
        from {
          opacity: 0;
          transform: translateX(20px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      /* ==== INPUT STYLES ==== */
      .input-box {
        margin-bottom: 1.5rem;
        position: relative;
      }

      .form-row {
        display: flex;
        gap: 1rem;
        flex-wrap: nowrap;
      }

      .form-row .input-box {
        flex: 1;
        min-width: 0;
        width: calc(50% - 0.5rem);
      }

      .input-box.full-width {
        width: 100%;
      }

      .input-box label {
        display: block;
        font-size: 14px;
        font-weight: 600;
        color: var(--lg-heading);
        margin-bottom: 0.5rem;
      }

      .input-box input,
      .input-box select {
        width: 100%;
        height: 55px;
        padding: 0 1rem;
        font-size: 15px;
        border: 2px solid rgba(225, 229, 238, 0.5);
        border-radius: 12px;
        transition: all 0.3s ease;
        background-color: rgba(248, 249, 250, 0.8);
        backdrop-filter: blur(5px);
      }

      .input-box input:focus,
      .input-box select:focus {
        border-color: var(--primary-color);
        background-color: rgba(255, 255, 255, 0.95);
        box-shadow: 0 0 0 4px rgba(51, 94, 234, 0.1);
        outline: none;
        transform: translateY(-2px);
      }

      .toggle-password {
        position: absolute;
        right: 1rem;
        top: 60%;
        transform: translateY(-50%);
        cursor: pointer;
        color: var(--text-content);
        transition: all 0.3s ease;
        font-size: 18px;
      }

      .toggle-password:hover {
        color: var(--primary-color);
        transform: translateY(-50%) scale(1.1);
      }

      /* ==== DYNAMIC FIELDS ==== */
      .dynamic-fields {
        display: none;
        margin-top: 1.5rem;
        padding-top: 1.5rem;
        border-top: 2px solid rgba(225, 229, 238, 0.3);
        animation: slideDown 0.3s ease-out;
      }

      .dynamic-fields.active {
        display: block;
      }

      @keyframes slideDown {
        from {
          opacity: 0;
          max-height: 0;
        }
        to {
          opacity: 1;
          max-height: 500px;
        }
      }

      .dynamic-fields-title {
        font-size: 18px;
        color: var(--lg-heading);
        margin-bottom: 1.5rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      /* ==== BUTTON STYLES ==== */
      .button {
        margin-top: 2rem;
      }

      .button input,
      .button button,
      .verify-button {
        width: 100%;
        height: 55px;
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        color: #fff;
        font-size: 16px;
        font-weight: 600;
        border-radius: 12px;
        border: none;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 8px 25px rgba(51, 94, 234, 0.3);
        position: relative;
        overflow: hidden;
      }

      .button input::before,
      .button button::before,
      .verify-button::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        transition: left 0.5s ease;
      }

      .button input:hover,
      .button button:hover,
      .verify-button:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 35px rgba(51, 94, 234, 0.4);
      }

      .button input:hover::before,
      .button button:hover::before,
      .verify-button:hover::before {
        left: 100%;
      }

      .button input:disabled,
      .button button:disabled,
      .verify-button:disabled {
        opacity: 0.7;
        cursor: not-allowed;
        transform: none;
      }

      /* ==== ALERT STYLES ==== */
      .alert {
        padding: 1rem;
        margin-bottom: 1.5rem;
        border-radius: 12px;
        text-align: center;
        font-size: 14px;
        border: none;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        animation: slideInAlert 0.3s ease-out;
      }

      @keyframes slideInAlert {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .alert.success {
        background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(16, 185, 129, 0.1));
        color: var(--success-color);
        border-left: 4px solid var(--success-color);
      }

      .alert.error {
        background: linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(239, 68, 68, 0.1));
        color: var(--error-color);
        border-left: 4px solid var(--error-color);
      }

      /* ==== OTP SECTION ==== */
      .otp-icon {
        width: 60px;
        height: 60px;
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        border-radius: 50%;
        margin: 0 auto 1.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        color: white;
        box-shadow: 0 10px 30px rgba(51, 94, 234, 0.3);
      }

      .otp-title {
        font-size: 24px;
        color: var(--lg-heading);
        margin-bottom: 0.5rem;
        font-weight: 700;
        text-align: center;
      }

      .otp-subtitle {
        color: var(--text-content);
        margin-bottom: 2rem;
        line-height: 1.6;
        text-align: center;
      }

      .email-highlight {
        color: var(--primary-color);
        font-weight: 600;
      }

      .otp-input {
        width: 100%;
        height: 60px;
        padding: 0 1rem;
        font-size: 1.5rem;
        text-align: center;
        border: 2px solid rgba(225, 229, 238, 0.5);
        border-radius: 12px;
        letter-spacing: 0.5rem;
        transition: all 0.3s ease;
        background-color: rgba(248, 249, 250, 0.8);
        backdrop-filter: blur(5px);
        margin-bottom: 1.5rem;
      }

      .otp-input:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 4px rgba(51, 94, 234, 0.1);
        background-color: rgba(255, 255, 255, 0.95);
        transform: translateY(-2px);
      }

      .resend-section {
        padding: 1.5rem 0;
        border-top: 2px solid rgba(225, 229, 238, 0.3);
        margin-top: 1.5rem;
        text-align: center;
      }

      .resend-text {
        color: var(--text-content);
        margin-bottom: 1rem;
        font-size: 14px;
      }

      .resend-button {
        background: none;
        border: 2px solid var(--primary-color);
        color: var(--primary-color);
        padding: 0.75rem 2rem;
        border-radius: 10px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
        font-size: 14px;
      }

      .resend-button:hover {
        background: var(--primary-color);
        color: white;
        transform: translateY(-2px);
      }

      .resend-button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
      }

      .timer {
        color: var(--error-color);
        font-weight: 600;
        margin-top: 1rem;
        font-size: 14px;
      }

      .back-to-form {
        margin-top: 1.5rem;
        text-align: center;
      }

      .back-to-form button {
        color: var(--text-content);
        text-decoration: none;
        font-weight: 500;
        border: none;
        background: none;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.3s ease;
      }

      .back-to-form button:hover {
        text-decoration: underline;
        color: var(--primary-color);
      }

      /* ==== LINKS ==== */
      .login-link {
        margin-top: 2rem;
        text-align: center;
        font-size: 15px;
        color: var(--text-content);
      }

      .login-link a {
        color: var(--primary-color);
        font-weight: 600;
        transition: all 0.3s ease;
      }

      .login-link a:hover {
        text-decoration: underline;
        color: var(--btn-hover-color);
      }

      /* ==== LOADING SPINNER ==== */
      .loading {
        opacity: 0.7;
        pointer-events: none;
      }

      .spinner {
        display: none;
        width: 20px;
        height: 20px;
        border: 2px solid transparent;
        border-top: 2px solid #fff;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-right: 0.5rem;
      }

      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      /* ==== STEP INDICATORS ==== */
      .step-indicator {
        display: flex;
        justify-content: center;
        align-items: center;
        margin-bottom: 2rem;
        gap: 1rem;
      }

      .step-dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background-color: rgba(225, 229, 238, 0.5);
        transition: all 0.3s ease;
        position: relative;
      }

      .step-dot.active {
        background-color: var(--primary-color);
        transform: scale(1.3);
        box-shadow: 0 0 0 4px rgba(51, 94, 234, 0.2);
      }

      .step-dot.completed {
        background-color: var(--success-color);
      }

      .step-line {
        width: 30px;
        height: 2px;
        background-color: rgba(225, 229, 238, 0.5);
        transition: all 0.3s ease;
      }

      .step-line.active {
        background-color: var(--primary-color);
      }

      /* ==== MEDIA QUERIES ==== */
      @media screen and (max-width: 1024px) {
        .image-side {
          width: 40%;
        }
        .form-side {
          width: 60%;
        }
      }

      @media screen and (max-width: 768px) {
        .toggle_btn {
          display: block;
        }
        
        .main-container {
          flex-direction: column;
        }
        
        .image-side {
          width: 100%;
          height: auto;
          padding: 3rem 2rem;
          min-height: 40vh;
        }
        
        .form-side {
          width: 100%;
          padding: 2rem 1.5rem;
        }
        
        .form-container {
          padding: 2rem;
          margin: 1rem 0;
        }

        .form-row {
        flex-direction: column;
        gap: 1rem;
        flex-wrap: nowrap;
      }

      .form-row .input-box {
        min-width: auto;
        width: 100%;
      }
        .nav_menu_list {
          display: none;
        }
      }

      @media screen and (max-width: 480px) {
        .logo h2 {
          font-size: 24px;
        }
        
        .header {
          padding: 0 1.5rem;
        }
        
        .form-container {
          padding: 1.5rem;
        }
        
        .form-container .title {
          font-size: 26px;
        }
        
        .welcome-text h3 {
          font-size: 24px;
        }

        .image-side {
          padding: 2rem 1.5rem;
        }
      }
    </style>
  </head>
  <body>
    <!-- ==== HEADER ==== -->
    <header class="header">
      <nav class="nav">
        <div class="logo">
          <h2>JobElevate.</h2>
        </div>
        <ul class="nav_menu_list">
          <li class="nav_menu_item">
            <a href="/" class="nav_menu_link">Home</a>
          </li>
          <li class="nav_menu_item">
            <a href="/login/" class="nav_menu_link">Login</a>
          </li>
        </ul>
        <button class="toggle_btn">
          <i class="ri-menu-line"></i>
        </button>
      </nav>
    </header>

    <!-- ==== MAIN CONTAINER ==== -->
    <div class="main-container">
      <!-- ==== IMAGE SIDE ==== -->
      <div class="image-side">
        <img src="{% static 'images/6368592.jpg' %}" alt="JobElevate Signup">
        <div class="welcome-text">
          <h3>Join JobElevate Today!</h3>
          <p>Create your account and start your journey towards finding the perfect job or talent. Connect with opportunities that match your skills and ambitions.</p>
        </div>
      </div>

      <!-- ==== FORM SIDE ==== -->
      <div class="form-side">
        <div class="form-container">
          <!-- Display Django Messages -->
          {% if messages %}
            {% for message in messages %}
              <div class="alert {% if message.tags == 'error' %}error{% else %}{{ message.tags }}{% endif %}">
                <i class="ri-{% if message.tags == 'error' %}error-warning{% elif message.tags == 'success' %}check-double{% else %}information{% endif %}-line"></i>
                {{ message }}
              </div>
            {% endfor %}
          {% endif %}

          <!-- Step Indicator -->
          <div class="step-indicator">
            <div class="step-dot active" id="step1-dot"></div>
            <div class="step-line" id="step1-line"></div>
            <div class="step-dot" id="step2-dot"></div>
          </div>

          <!-- Registration Form -->
          <div id="signup-form" class="signup-form active">
            <h1 class="title">
              <i class="ri-user-add-line"></i>
              Create Account
            </h1>
            <p class="subtitle">Join our community and unlock your career potential</p>

            <form id="registrationForm" method="post">
              {% csrf_token %}
              <input type="hidden" name="step" value="1">

              <!-- Basic Information -->
              <div class="form-row">
                <div class="input-box">
                  <label for="full_name">Full Name *</label>
                  <input type="text" id="full_name" name="full_name" required value="{{ form_data.full_name|default:'' }}">
                </div>
                <div class="input-box">
                  <label for="username">Username *</label>
                  <input type="text" id="username" name="username" required value="{{ form_data.username|default:'' }}">
                </div>
              </div>

              <div class="form-row">
                <div class="input-box">
                  <label for="email">Email Address *</label>
                  <input type="email" id="email" name="email" required value="{{ form_data.email|default:'' }}">
                </div>
                <div class="input-box">
                  <label for="phone_number">Phone Number *</label>
                  <input type="tel" id="phone_number" name="phone_number" required value="{{ form_data.phone_number|default:'' }}">
                </div>
              </div>

              <div class="form-row">
                <div class="input-box">
                  <label for="password">Password *</label>
                  <input type="password" id="password" name="password" required>
                  <i class="toggle-password ri-eye-off-line" onclick="togglePassword('password')"></i>
                </div>
                <div class="input-box">
                  <label for="confirm_password">Confirm Password *</label>
                  <input type="password" id="confirm_password" name="confirm_password" required>
                  <i class="toggle-password ri-eye-off-line" onclick="togglePassword('confirm_password')"></i>
                </div>
              </div>

              <div class="input-box full-width">
                <label for="user_type">I am a *</label>
                <select id="user_type" name="user_type" required onchange="showDynamicFields()">
                  <option value="">Select your role</option>
                  <option value="student" {% if form_data.user_type == 'student' %}selected{% endif %}>Student</option>
                  <option value="professional" {% if form_data.user_type == 'professional' %}selected{% endif %}>Professional</option>
                  <option value="recruiter" {% if form_data.user_type == 'recruiter' %}selected{% endif %}>Recruiter</option>
                </select>
              </div>

              <!-- Dynamic Fields for Student -->
              <div id="student-fields" class="dynamic-fields">
                <h3 class="dynamic-fields-title">
                  <i class="ri-graduation-cap-line"></i>
                  Student Information
                </h3>
                <div class="form-row">
                  <div class="input-box">
                    <label for="university">University</label>
                    <input type="text" id="university" name="university" value="{{ form_data.university|default:'' }}">
                  </div>
                  <div class="input-box">
                    <label for="degree">Degree</label>
                    <input type="text" id="degree" name="degree" value="{{ form_data.degree|default:'' }}">
                  </div>
                </div>
                <div class="input-box full-width">
                  <label for="graduation_year">Expected Graduation Year</label>
                  <input type="number" id="graduation_year" name="graduation_year" min="2020" max="2035" value="{{ form_data.graduation_year|default:'' }}">
                </div>
              </div>

              <!-- Dynamic Fields for Professional -->
              <div id="professional-fields" class="dynamic-fields">
                <h3 class="dynamic-fields-title">
                  <i class="ri-briefcase-line"></i>
                  Professional Information
                </h3>
                <div class="form-row">
                  <div class="input-box">
                    <label for="job_title">Current Job Title</label>
                    <input type="text" id="job_title" name="job_title" value="{{ form_data.job_title|default:'' }}">
                  </div>
                  <div class="input-box">
                    <label for="organization">Organization</label>
                    <input type="text" id="organization" name="organization" value="{{ form_data.organization|default:'' }}">
                  </div>
                </div>
                <div class="input-box full-width">
                  <label for="experience">Years of Experience</label>
                  <input type="number" id="experience" name="experience" min="0" max="50" value="{{ form_data.experience|default:'' }}">
                </div>
              </div>

              <!-- Dynamic Fields for Recruiter -->
              <div id="recruiter-fields" class="dynamic-fields">
                <h3 class="dynamic-fields-title">
                  <i class="ri-building-line"></i>
                  Company Information
                </h3>
                <div class="form-row">
                  <div class="input-box">
                    <label for="company_name">Company Name</label>
                    <input type="text" id="company_name" name="company_name" value="{{ form_data.company_name|default:'' }}">
                  </div>
                  <div class="input-box">
                    <label for="company_website">Company Website</label>
                    <input type="url" id="company_website" name="company_website" value="{{ form_data.company_website|default:'' }}">
                  </div>
                </div>
                <div class="input-box full-width">
                  <label for="company_description">Company Description</label>
                  <input type="text" id="company_description" name="company_description" value="{{ form_data.company_description|default:'' }}">
                </div>
              </div>

              <div class="button">
                <input type="submit" value="Create Account">
              </div>
            </form>

            <div class="login-link">
              Already have an account? <a href="/login/">Sign in here</a>
            </div>
          </div>

          <!-- OTP Verification Section -->
          <div id="otp-section" class="otp-section">
            <div class="otp-icon">
              <i class="ri-mail-check-line"></i>
            </div>
            <h2 class="otp-title">Verify Your Email</h2>
            <p class="otp-subtitle">
              We've sent a 6-digit verification code to<br>
              <span class="email-highlight" id="verification-email"></span>
            </p>

            <form id="otpForm">
              {% csrf_token %}
              <input type="hidden" name="step" value="2">
              
              <div class="otp-input-group">
                <input type="text" id="email_otp" name="email_otp" class="otp-input" maxlength="6" placeholder="000000" required>
              </div>

              <button type="submit" class="verify-button">
                <span id="verify-btn-text">Verify Email</span>
              </button>
            </form>

            <div class="resend-section">
              <p class="resend-text">Didn't receive the code?</p>
              <button type="button" id="resend-btn" class="resend-button" onclick="resendOTP()">
                Resend Code
              </button>
              <div id="timer" class="timer" style="display: none;"></div>
            </div>

            <div class="back-to-form">
              <button type="button" onclick="backToForm()">
                <i class="ri-arrow-left-line"></i> Back to registration
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Toggle password visibility
      function togglePassword(fieldId) {
        const field = document.getElementById(fieldId);
        const icon = field.nextElementSibling;
        
        if (field.type === 'password') {
          field.type = 'text';
          icon.classList.remove('ri-eye-off-line');
          icon.classList.add('ri-eye-line');
        } else {
          field.type = 'password';
          icon.classList.remove('ri-eye-line');
          icon.classList.add('ri-eye-off-line');
        }
      }

      // Show dynamic fields based on user type
      function showDynamicFields() {
        const userType = document.getElementById('user_type').value;
        const studentFields = document.getElementById('student-fields');
        const professionalFields = document.getElementById('professional-fields');
        const recruiterFields = document.getElementById('recruiter-fields');

        // Hide all dynamic fields
        studentFields.classList.remove('active');
        professionalFields.classList.remove('active');
        recruiterFields.classList.remove('active');

        // Show relevant fields
        if (userType === 'student') {
          studentFields.classList.add('active');
        } else if (userType === 'professional') {
          professionalFields.classList.add('active');
        } else if (userType === 'recruiter') {
          recruiterFields.classList.add('active');
        }
      }

      // Initialize dynamic fields on page load
      document.addEventListener('DOMContentLoaded', function() {
        showDynamicFields();
      });

      // Handle registration form submission
      document.getElementById('registrationForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const submitBtn = this.querySelector('input[type="submit"]');
        const originalText = submitBtn.value;
        
        // Show loading state
        submitBtn.value = 'Sending OTP...';
        submitBtn.disabled = true;
        
        const formData = new FormData(this);
        
        fetch('/signup/', {
          method: 'POST',
          body: formData,
          headers: {
            'X-Requested-With': 'XMLHttpRequest',
          }
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            // Show OTP section
            document.getElementById('signup-form').style.display = 'none';
            document.getElementById('otp-section').classList.add('active');
            document.getElementById('verification-email').textContent = data.email;
            startResendTimer();
          } else {
            showAlert(data.message, 'error');
          }
        })
        .catch(error => {
          console.error('Error:', error);
          showAlert('An error occurred. Please try again.', 'error');
        })
        .finally(() => {
          // Reset button state
          submitBtn.value = originalText;
          submitBtn.disabled = false;
        });
      });

      // Handle OTP verification
      document.getElementById('otpForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const submitBtn = this.querySelector('.verify-button');
        const btnText = document.getElementById('verify-btn-text');
        const originalText = btnText.textContent;
        
        // Show loading state
        btnText.innerHTML = '<span class="spinner"></span>Verifying...';
        submitBtn.disabled = true;
        
        const formData = new FormData(this);
        
        fetch('/signup/', {
          method: 'POST',
          body: formData,
          headers: {
            'X-Requested-With': 'XMLHttpRequest',
          }
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            showAlert(data.message, 'success');
            setTimeout(() => {
              if (data.redirect_url) {
                window.location.href = data.redirect_url;
              }
            }, 2000);
          } else {
            showAlert(data.message, 'error');
          }
        })
        .catch(error => {
          console.error('Error:', error);
          showAlert('An error occurred. Please try again.', 'error');
        })
        .finally(() => {
          // Reset button state
          btnText.textContent = originalText;
          submitBtn.disabled = false;
        });
      });

      // Resend OTP functionality
      let resendTimer;
      let resendCountdown = 60;

      function resendOTP() {
        const resendBtn = document.getElementById('resend-btn');
        resendBtn.disabled = true;
        resendBtn.textContent = 'Sending...';
        
        fetch('/resend-otp/', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
            'X-Requested-With': 'XMLHttpRequest',
          }
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            showAlert(data.message, 'success');
            startResendTimer();
          } else {
            showAlert(data.message, 'error');
          }
        })
        .catch(error => {
          console.error('Error:', error);
          showAlert('An error occurred. Please try again.', 'error');
        })
        .finally(() => {
          resendBtn.disabled = false;
          resendBtn.textContent = 'Resend Code';
        });
      }

      function startResendTimer() {
        const resendBtn = document.getElementById('resend-btn');
        const timer = document.getElementById('timer');
        
        resendCountdown = 60;
        resendBtn.disabled = true;
        timer.style.display = 'block';
        
        resendTimer = setInterval(() => {
          resendCountdown--;
          timer.textContent = `Resend code in ${resendCountdown} seconds`;
          
          if (resendCountdown <= 0) {
            clearInterval(resendTimer);
            resendBtn.disabled = false;
            timer.style.display = 'none';
          }
        }, 1000);
      }

      function backToForm() {
        document.getElementById('otp-section').classList.remove('active');
        document.getElementById('signup-form').style.display = 'block';
        
        // Clear OTP input
        document.getElementById('email_otp').value = '';
        
        // Clear any existing timer
        if (resendTimer) {
          clearInterval(resendTimer);
        }
      }

      function showAlert(message, type) {
        // Remove existing alerts
        const existingAlerts = document.querySelectorAll('.alert');
        existingAlerts.forEach(alert => alert.remove());
        
        const alertDiv = document.createElement('div');
        alertDiv.className = `alert ${type}`;
        alertDiv.textContent = message;
        
        const formContainer = document.querySelector('.form-container');
        formContainer.insertBefore(alertDiv, formContainer.firstChild);
        
        // Auto-remove alert after 5 seconds
        setTimeout(() => {
          if (alertDiv.parentNode) {
            alertDiv.remove();
          }
        }, 5000);
      }

      // Auto-format OTP input
      document.getElementById('email_otp').addEventListener('input', function(e) {
        let value = e.target.value.replace(/\D/g, ''); // Remove non-digits
        if (value.length > 6) {
          value = value.substring(0, 6);
        }
        e.target.value = value;
      });

      // Auto-submit OTP when 6 digits are entered
      document.getElementById('email_otp').addEventListener('input', function(e) {
        if (e.target.value.length === 6) {
          setTimeout(() => {
            document.getElementById('otpForm').dispatchEvent(new Event('submit'));
          }, 500);
        }
      });

      // Prevent form submission on Enter key for OTP input
      document.getElementById('email_otp').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          e.preventDefault();
          if (this.value.length === 6) {
            document.getElementById('otpForm').dispatchEvent(new Event('submit'));
          }
        }
      });

      // Password strength indicator
      document.getElementById('password').addEventListener('input', function(e) {
        const password = e.target.value;
        const strength = checkPasswordStrength(password);
        updatePasswordStrength(strength);
      });

      function checkPasswordStrength(password) {
        let score = 0;
        if (password.length >= 8) score += 25;
        if (/[a-z]/.test(password)) score += 25;
        if (/[A-Z]/.test(password)) score += 25;
        if (/\d/.test(password)) score += 25;
        
        return score;
      }

      function updatePasswordStrength(strength) {
        // You can add a password strength indicator here if needed
        // For now, we'll just validate on form submission
      }

      // Phone number validation
      document.getElementById('phone_number').addEventListener('input', function(e) {
        let value = e.target.value.replace(/\D/g, ''); // Remove non-digits
        if (value.length > 15) {
          value = value.substring(0, 15);
        }
        e.target.value = value;
      });

      // Username validation (no spaces, lowercase, alphanumeric)
      document.getElementById('username').addEventListener('input', function(e) {
        let value = e.target.value.toLowerCase().replace(/[^a-z0-9_]/g, '');
        e.target.value = value;
      });

      // Graduation year validation
      document.getElementById('graduation_year').addEventListener('input', function(e) {
        const currentYear = new Date().getFullYear();
        const maxYear = currentYear + 10;
        const minYear = currentYear - 10;
        
        if (parseInt(e.target.value) > maxYear) {
          e.target.value = maxYear;
        } else if (parseInt(e.target.value) < minYear) {
          e.target.value = minYear;
        }
      });

      // Experience validation
      document.getElementById('experience').addEventListener('input', function(e) {
        if (parseInt(e.target.value) > 50) {
          e.target.value = 50;
        } else if (parseInt(e.target.value) < 0) {
          e.target.value = 0;
        }
      });

      // Email validation
      function validateEmail(email) {
        const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return re.test(email);
      }

      // Real-time email validation
      document.getElementById('email').addEventListener('blur', function(e) {
        const email = e.target.value;
        if (email && !validateEmail(email)) {
          showAlert('Please enter a valid email address.', 'error');
          e.target.focus();
        }
      });

      // Confirm password validation
      document.getElementById('confirm_password').addEventListener('blur', function(e) {
        const password = document.getElementById('password').value;
        const confirmPassword = e.target.value;
        
        if (confirmPassword && password !== confirmPassword) {
          showAlert('Passwords do not match.', 'error');
          e.target.focus();
        }
      });

      // Form validation before submission
      function validateForm() {
        const requiredFields = ['full_name', 'username', 'email', 'phone_number', 'password', 'confirm_password', 'user_type'];
        
        for (let fieldId of requiredFields) {
          const field = document.getElementById(fieldId);
          if (!field.value.trim()) {
            showAlert(`Please fill in the ${field.previousElementSibling.textContent.replace(' *', '')}.`, 'error');
            field.focus();
            return false;
          }
        }
        
        const email = document.getElementById('email').value;
        if (!validateEmail(email)) {
          showAlert('Please enter a valid email address.', 'error');
          document.getElementById('email').focus();
          return false;
        }
        
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirm_password').value;
        
        if (password !== confirmPassword) {
          showAlert('Passwords do not match.', 'error');
          document.getElementById('confirm_password').focus();
          return false;
        }
        
        if (password.length < 8 || !/[A-Za-z]/.test(password) || !/\d/.test(password)) {
          showAlert('Password must be at least 8 characters long and contain both letters and numbers.', 'error');
          document.getElementById('password').focus();
          return false;
        }
        
        return true;
      }

      // Add form validation to the submit event
      document.getElementById('registrationForm').addEventListener('submit', function(e) {
        if (!validateForm()) {
          e.preventDefault();
          return false;
        }
      });

      // Handle browser back button
      window.addEventListener('popstate', function(e) {
        if (document.getElementById('otp-section').classList.contains('active')) {
          backToForm();
        }
      });

      // Prevent multiple form submissions
      let isSubmitting = false;
      
      document.getElementById('registrationForm').addEventListener('submit', function(e) {
        if (isSubmitting) {
          e.preventDefault();
          return false;
        }
        isSubmitting = true;
        
        setTimeout(() => {
          isSubmitting = false;
        }, 3000);
      });

      document.getElementById('otpForm').addEventListener('submit', function(e) {
        if (isSubmitting) {
          e.preventDefault();
          return false;
        }
        isSubmitting = true;
        
        setTimeout(() => {
          isSubmitting = false;
        }, 3000);
      });
    </script>
  </body>
</html>